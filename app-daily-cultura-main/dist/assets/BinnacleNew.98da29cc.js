import{m as Ie,E as p,s as T,r as D,H as L,b as Ae,v as E,ao as B,c as Ee,X as xe,N as M,f as g,g as x,i as n,w as Ce,j as Oe,t as U,l as e,y as F,k as V,h as c,ad as De,n as he,F as Pe,u as Se,q as Ue,O as k,Q as Ne}from"./index.c93647e1.js";import{p as H}from"./permissions.c73d0fc1.js";import{u as Re}from"./index.esm.8471a966.js";import{r,a as J,c as $e,d as Y,m as we}from"./validations.9fff8c5b.js";import{_ as b}from"./Input.d2784565.js";import{_ as m}from"./Select.7b4ad9bd.js";import{_ as je}from"./Radio.33857de6.js";import{_ as Te,a as N}from"./Management.8f9978fe.js";import{_ as Le}from"./Aggregates.ce7a7b06.js";import{B as Be}from"./binnacles.service.7a3aef03.js";import{c as G}from"./generals.service.ee73141b.js";import{p as Me}from"./pecs.service.c1afe54a.js";import{P as Fe}from"./pedagogical.service.1714510b.js";import{_ as C}from"./Textarea.8cc31183.js";import{s as ke}from"./scroll.6a87917e.js";import{_ as He}from"./FormHeader.f0e8692c.js";import"./index.esm.c98934a4.js";import"./useSlug.fdbf14df.js";import"./index.37cca9d1.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const Je=Ie("binnacleStore",{state:()=>({form:{consecutive:"",binnacle_id:p.computed.is_role("monitor_cultural")?"JP":"",type:"other",activity_name:null,activity_date:null,start_time:null,final_hour:null,place:null,nac_id:"",expertise_id:"",cultural_right_id:"",experiential_objective:null,lineament_id:"",orientation_id:"",goals_met:null,explain_goals_met:null,start_activity:null,activity_development:null,end_of_activity:null,observations_activity:null,development_activity_image:null,evidence_participation_image:null,pedagogical_id:"",pec_id:"",beneficiaries_capacity:"",assistants:"",aforo_file:"",aggregates:{beneficiaries:[]},group_id:"",beneficiaries_or_capacity:""},form_rules:{consecutive:{},type:{},binnacle_id:{required:r},activity_name:{alpha:J,required:r,alphaOrAlphanumeric:$e},activity_date:{required:r},start_time:{required:r,checkMinMaxHours:Y("start_time","final_hour")},final_hour:{required:r,checkMinMaxHours:Y("start_time","final_hour")},place:{required:r,alpha:J},nac_id:{required:r},expertise_id:{required:r},cultural_right_id:{required:r},experiential_objective:{required:r},lineament_id:{required:r},orientation_id:{required:r},goals_met:{required:r},explain_goals_met:{required:r},start_activity:{required:r},activity_development:{required:r},end_of_activity:{required:r},observations_activity:{required:r},development_activity_image:{required:r},evidence_participation_image:{required:r},beneficiariesTable:{},pedagogical_id:{required:r},pec_id:{required:r},beneficiaries_capacity:{},aforo_file:{},aggregates:{beneficiaries:{}},group_id:{},beneficiaries_or_capacity:{}},form_options:{activation_mode:[{value:"presencial",text:"Presencial"},{value:"virtual",text:"Virtual"}],goals_met:[{value:"si",text:"Si"},{value:"no",text:"No"}]}}),getters:{get_form_rules_computed:u=>({...u.form_rules,aforo_file:u.form.beneficiaries_or_capacity==="aforo"?{required:r}:{},beneficiaries_capacity:u.form.beneficiaries_or_capacity==="aforo"?{required:r}:{},pec_id:p.computed.is_role("embajador")?{}:{required:r},pedagogical_id:p.computed.is_role("embajador")?{}:{required:r},aggregates:{beneficiaries:!p.computed.is_role("embajador")&&u.form.beneficiaries_or_capacity==="beneficiaries"?{required:r,minLength:we(1)}:{}}}),get_transpiled_data(){const{aggregates:u,...s}=this.form;return{...s,beneficiary_id:u.beneficiaries.map(t=>t.id)}}},actions:{push_aggregate(u){this.$patch(s=>{s.form.aggregates.beneficiaries.push(u)})},pop_aggregate(u){this.$patch(s=>{const t=s.form.aggregates.beneficiaries.findIndex(h=>h.id===u);s.form.aggregates.beneficiaries.splice(t,1)})}}}),Ye={class:"intro-y box mt-5"},Ge=["disabled"],Xe=["onSubmit"],qe={class:"flex flex-col lg:grid lg:grid-cols-2 xl:grid xl:grid-cols-3 gap-6 justify-evenly mb-8"},ze={class:"w-full"},Qe={class:"w-full intro-x"},Ke={key:0,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-6 mb-8"},We={class:"flex flex-col lg:grid lg:grid-cols-2 xl:grid xl:grid-cols-3 gap-6 justify-evenly mb-8"},Ze={class:"grid grid-cols-1 gap-6 mb-8"},ea={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},aa={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-6 mb-8"},ia={key:2,class:"w-full"},ta={key:3,class:"flex flex-col justify-start mb-8"},oa={class:"intro-y form-label font-bold uppercase"},la=c("span",null," Asistentes Agregados ",-1),na={class:"overflow-x-auto overflow-y-hidden"},ra={class:"flex justify-end"},sa=["disabled"],La={__name:"BinnacleNew",setup(u){const s=Je(),{form:t,get_form_rules_computed:h,form_options:X}=T(s),_=Be(),P=G(),{byActivityDate:q}=Me(),{byRangeActivityDate:z}=Fe(),O=D(!1);Se();const R=Ue(),v=L({I:[],II:[],III:[]}),Q=[{value:"aforo",label:"Aforo"},{value:"beneficiaries",label:"Beneficiarios"}],K=Ae(),{options:f}=T(K),W=E(()=>{const{is_role:o,is_admin:i}=p.computed,{binnacles:a}=f.value;if(i()||o("gestores_culturales")||o("apoyo_seguimiento_monitoreo")||o("lider_instructor")||o("lider_embajador"))return a.filter(({value:d})=>d=="JP"||d=="SC"||d=="TP"||d=="EC"||d=="AC");if(o("monitor_cultural"))return a.filter(({value:d})=>d=="JP");if(o("instructor"))return a.filter(({value:d})=>d=="SC"||d=="TP"||d=="EC");if(o("embajador"))return a.filter(({value:d})=>d=="AC")}),$=E(()=>{const{is_role:o}=p.computed,i=t.value.binnacle_id,a=t.value.beneficiaries_or_capacity;if(o("super.root"))return!0;if(o("instructor")){if(i=="SC")return!0;if(i=="TP")return!1;if(i=="EC"&&a=="beneficiaries")return!0}else if((o("monitor_cultural")||o("apoyo_seguimiento_monitoreo")||o("gestores_culturales")||o("direccion")||o("subdireccion"))&&i=="JP")return!0}),y=E(()=>!!R.params.id),S=async()=>await P.getConsecutive("binnacles","JP").then(()=>{I.consecutive=P.data.value,t.value.consecutive=P.data.value}),Z=async()=>await _.getOne(R.params.id),I=L({status:"",reject_message:""});function w(o){const[i,a]=o.split(":"),d=i>=12?"PM":"AM";return`${i%12||12}:${a} ${d}`}D([]),D([]);const ee=B(async()=>{const o=await z(),{items:i}=o.data;return i.map(a=>({value:a.id,label:`${a.consecutive} - ${k(a.activity_date).format("DD/MM/YYYY")}`}))}),ae=B(async()=>{const o=await q(),{items:i}=o.data;return i.map(a=>({value:a.id,label:`${a.consecutive} - ${k(a.activity_date).format("DD/MM/YYYY")} - ${w(a.start_time)} - ${w(a.final_hour)}`}))},null);Ee(async()=>{if(y.value){s.$reset(),l.value.$reset(),await Z().catch(()=>{p.not_found_by_id()});const{activation_mode:o,assistants:i,beneficiaries:a,created_at:d,created_by:_e,deleted_at:da,id:ca,reject_message:pe,updated_at:ua,status:fe,user_method_support_id:ma,user_review_instructor_leader_id:_a,user_review_manager_cultural_id:pa,user_review_support_follow_id:fa,...ve}=_.data.one;s.$patch(ge=>{Object.assign(ge.form,{...ve,aggregates:{beneficiaries:a.map(({id:be,document_number:ye,full_name:Ve})=>({id:be,full_name:Ve,nuip:ye}))}})}),I.status=fe,I.reject_message=pe}else s.$reset(),l.value.$reset(),await S(),await j(0)}),xe(()=>{s.$reset(),l.value.$reset()});const l=Re(h,t,{$autoDirty:!0,$lazy:!0}),ie=async()=>{await l.value.$validate()?(O.value=!0,y.value?await _.update(_.data.one.id,s.get_transpiled_data,"monitor").finally(()=>{O.value=!1}):await S().finally(()=>{_.create(s.get_transpiled_data,"monitor").then(async i=>{i.data.success&&(s.$reset(),l.value.$reset(),await S(),ke(),v.I=[],v.II=[],v.III=[])}).finally(()=>{O.value=!1})})):Ne.validation()},A=E(()=>t.value.binnacle_id);M(A,()=>{A.value=="JP"||A.value=="SC"?t.value.beneficiaries_or_capacity="beneficiaries":(A.value=="TP"||A.value=="AC")&&(t.value.beneficiaries_or_capacity="aforo")});const te=(o,i)=>{if(o)return;const{file:a}=i;t.value.development_activity_image=a},oe=(o,i)=>{if(o)return;const{file:a}=i;t.value.evidence_participation_image=a},le=(o,i)=>{if(o)return;const{file:a}=i;t.value.aforo_file=a},ne=()=>{t.value.development_activity_image=null},re=()=>{t.value.evidence_participation_image=null},se=()=>{t.value.aforo_file=null,v.value=[]},de=[{text:"ID",value:"id"},{text:"NOMBRE",value:"full_name"},{text:"C\xC9DULA",value:"nuip"}],ce=G(),ue=D([]),j=async o=>{y.value||await ce.getGroupBeneficiaries(o).then(i=>{if(i!=null){let a=i.data.items[0].beneficiaries;ue.value=a,s.$patch(d=>{Object.assign(d.form,{aggregates:{beneficiaries:a}})})}})},me=E(()=>t.value.group_id);return M(me,async(o,i)=>{o!=""&&o!=null&&o!=i&&await j(o)}),(o,i)=>(g(),x(Pe,null,[n(He,{state:{consecutive:e(t).consecutive,status:e(I).status,reject_message:e(I).reject_message}},{default:Ce(()=>[Oe(U(e(y)?`Edici\xF3n de Bit\xE1cora Jornada Pacto #${e(_).data.one.id}`:`Bit\xE1cora Jornada
        Pacto`),1)]),_:1},8,["state"]),e(y)&&e(H).binnacles.management()?(g(),F(Te,{key:0,class:"mt-5",onSend:i[0]||(i[0]=a=>e(p).methods.send_management("binnacles",e(_).data.one.id,a))})):V("",!0),c("div",Ye,[c("fieldset",{disabled:e(H).binnacles.no_edit()},[c("form",{onSubmit:De(ie,["prevent"]),class:"p-5 border-t border-slate-200/60 dark:border-darkmode-400"},[c("section",qe,[c("template",{class:he([e(t).binnacle_id==="EC"||e(t).binnacle_id==="TP"?"grid-cols-2":"grid-cols-1","grid gap-3"])},[c("div",ze,[n(m,{label:"BIT\xC1CORA",tooltip:"Ingrese la bit\xE1cora",name:"binnacle_id",modelValue:e(t).binnacle_id,"onUpdate:modelValue":i[1]||(i[1]=a=>e(t).binnacle_id=a),options:e(W),validator:e(l)},null,8,["modelValue","options","validator"])]),c("div",Qe,[e(t).binnacle_id==="EC"||e(t).binnacle_id==="TP"?(g(),F(m,{key:0,label:"BENEFICIARIOS O AFORO",tooltip:"Beneficiarios o Aforo",name:"beneficiaries_or_capacity",modelValue:e(t).beneficiaries_or_capacity,"onUpdate:modelValue":i[2]||(i[2]=a=>e(t).beneficiaries_or_capacity=a),options:Q,validator:e(l)},null,8,["modelValue","validator"])):V("",!0)])],2),n(b,{type:"text",label:"NOMBRE DE ACTIVIDAD",tooltip:"Ingrese el nombre de la actividad",placeholder:"Nombre de la actividad",name:"activity_name",modelValue:e(t).activity_name,"onUpdate:modelValue":i[3]||(i[3]=a=>e(t).activity_name=a),validator:e(l)},null,8,["modelValue","validator"]),n(b,{type:"date",label:"FECHA DE ACTIVIDAD",tooltip:"Ingrese la fecha de la actividad",placeholder:"Fecha de la actividad",name:"activity_date",modelValue:e(t).activity_date,"onUpdate:modelValue":i[4]||(i[4]=a=>e(t).activity_date=a),validator:e(l)},null,8,["modelValue","validator"]),n(b,{type:"time",label:"HORA INICIO",tooltip:"Ingrese la hora de inicio",placeholder:"Hora inicio",name:"start_time",modelValue:e(t).start_time,"onUpdate:modelValue":i[5]||(i[5]=a=>e(t).start_time=a),validator:e(l)},null,8,["modelValue","validator"]),n(b,{type:"time",label:"HORA FINAL",tooltip:"Ingrese la hora final",placeholder:"Hora final",name:"final_hour",modelValue:e(t).final_hour,"onUpdate:modelValue":i[6]||(i[6]=a=>e(t).final_hour=a),validator:e(l)},null,8,["modelValue","validator"]),n(b,{type:"text",label:"LUGAR",tooltip:"Ingrese el lugar",placeholder:"Lugar",name:"place",modelValue:e(t).place,"onUpdate:modelValue":i[7]||(i[7]=a=>e(t).place=a),validator:e(l)},null,8,["modelValue","validator"])]),e(p).computed.is_role("embajador")?V("",!0):(g(),x("section",Ke,[n(m,{value:e(t).pec_id,label:"PEC",tooltip:"Seleccionar PEC",placeholder:"PEC",name:"pec_id",modelValue:e(t).pec_id,"onUpdate:modelValue":i[8]||(i[8]=a=>e(t).pec_id=a),validator:e(l),options:e(ae)||null},null,8,["value","modelValue","validator","options"]),n(m,{value:e(t).pedagogical_id,label:"FICHA PEDAG\xD3GICA",tooltip:"Seleccionar ficha pedag\xF3gica",placeholder:"Ficha pedag\xF3gica",name:"pedagogical_id",modelValue:e(t).pedagogical_id,"onUpdate:modelValue":i[9]||(i[9]=a=>e(t).pedagogical_id=a),validator:e(l),options:e(ee)||null},null,8,["value","modelValue","validator","options"])])),c("section",We,[n(m,{label:"NAC",tooltip:"Ingrese el NAC",placeholder:"Seleccione",name:"nac_id",modelValue:e(t).nac_id,"onUpdate:modelValue":i[10]||(i[10]=a=>e(t).nac_id=a),options:e(f).nacs||null,validator:e(l)},null,8,["modelValue","options","validator"]),n(m,{label:"EXPERTICIA",tooltip:"Ingrese la Experticia",placeholder:"Seleccione",name:"expertise_id",modelValue:e(t).expertise_id,"onUpdate:modelValue":i[11]||(i[11]=a=>e(t).expertise_id=a),options:e(f).expertises||null,validator:e(l)},null,8,["modelValue","options","validator"]),n(m,{label:"DERECHO CULTURAL",tooltip:"Ingrese el Derecho Cultural",placeholder:"Seleccione",name:"cultural_right_id",modelValue:e(t).cultural_right_id,"onUpdate:modelValue":i[12]||(i[12]=a=>e(t).cultural_right_id=a),options:e(f).cultural_rights||null,validator:e(l)},null,8,["modelValue","options","validator"]),n(b,{type:"text",label:"OBJETIVO VIVENCIAL",tooltip:"Ingrese objetivo vivencial",placeholder:"Objetivo vivencial...",name:"experiential_objective",modelValue:e(t).experiential_objective,"onUpdate:modelValue":i[13]||(i[13]=a=>e(t).experiential_objective=a),validator:e(l)},null,8,["modelValue","validator"]),n(m,{label:"LINEAMIENTOS",tooltip:"Ingrese los lineamientos",placeholder:"Seleccione",name:"lineament_id",modelValue:e(t).lineament_id,"onUpdate:modelValue":i[14]||(i[14]=a=>e(t).lineament_id=a),options:e(f).lineaments||null,validator:e(l)},null,8,["modelValue","options","validator"]),n(m,{label:"ORIENTACIONES",tooltip:"Ingrese las orientaciones",placeholder:"Seleccione",name:"orientation_id",modelValue:e(t).orientation_id,"onUpdate:modelValue":i[15]||(i[15]=a=>e(t).orientation_id=a),options:e(f).orientations||null,validator:e(l)},null,8,["modelValue","options","validator"]),n(je,{label:"\xBFSE CUMPLI\xD3 EL OBJETIVO VIVENCIAL DURANTE LA JORNADA DE ACTIVACI\xD3N CULTURAL?",tooltip:"Objetivo",name:"goals_met",modelValue:e(t).goals_met,"onUpdate:modelValue":i[16]||(i[16]=a=>e(t).goals_met=a),options:e(X).goals_met,validator:e(l)},null,8,["modelValue","options","validator"])]),c("section",Ze,[n(C,{rows:"5",label:"EXPLIQUE EL \xBFPOR QUE?",tooltip:"",placeholder:"Porque...",name:"explain_goals_met",modelValue:e(t).explain_goals_met,"onUpdate:modelValue":i[17]||(i[17]=a=>e(t).explain_goals_met=a),validator:e(l)},null,8,["modelValue","validator"]),n(C,{rows:"5",label:"INICIO",tooltip:"",placeholder:"Inicio...",name:"start_activity",modelValue:e(t).start_activity,"onUpdate:modelValue":i[18]||(i[18]=a=>e(t).start_activity=a),validator:e(l)},null,8,["modelValue","validator"]),n(C,{rows:"5",label:"DESARROLLO",tooltip:"",placeholder:"Desarrollo...",name:"activity_development",modelValue:e(t).activity_development,"onUpdate:modelValue":i[19]||(i[19]=a=>e(t).activity_development=a),validator:e(l)},null,8,["modelValue","validator"]),n(C,{rows:"5",label:"FINAL (REFLEXI\xD3N DE LA JORNADA DE EXPERIMENTACI\xD3N)",tooltip:"",placeholder:"Reflexi\xF3n de la jornada de experimentaci\xF3n...",name:"end_of_activity",modelValue:e(t).end_of_activity,"onUpdate:modelValue":i[20]||(i[20]=a=>e(t).end_of_activity=a),validator:e(l)},null,8,["modelValue","validator"]),n(C,{rows:"5",label:"OBSERVACIONES",tooltip:"",placeholder:"Observaciones...",name:"observations_activity",modelValue:e(t).observations_activity,"onUpdate:modelValue":i[21]||(i[21]=a=>e(t).observations_activity=a),validator:e(l)},null,8,["modelValue","validator"])]),c("section",ea,[n(N,{label:"DESARROLLO DE LA JORNADA DE PACTO *",tooltip:"Arrastra una imagen",name:"development_activity_image",ref:"development_activity_image_ref",to_edit:e(_).data.one.development_activity_image,modelValue:e(t).development_activity_image,"onUpdate:modelValue":i[22]||(i[22]=a=>e(t).development_activity_image=a),onAddfile:te,onRemovefile:ne,files:e(v).I,validator:e(l)},null,8,["to_edit","modelValue","files","validator"]),n(N,{label:"EVIDENCIA DE PARTICIPACI\xD3N *",tooltip:"Arrastra una imagen",name:"evidence_participation_image",ref:"evidence_participation_image",to_edit:e(_).data.one.evidence_participation_image,modelValue:e(t).evidence_participation_image,"onUpdate:modelValue":i[23]||(i[23]=a=>e(t).evidence_participation_image=a),onAddfile:oe,onRemovefile:re,files:e(v).II,validator:e(l)},null,8,["to_edit","modelValue","files","validator"])]),e(t).beneficiaries_or_capacity=="aforo"||e(t).binnacle_id=="AC"?(g(),x("div",aa,[n(N,{label:"DOCUMENTO DEL AFORO *",tooltip:"Arrastra un documento PDF",name:"aforo_file",ref:"aforo_file",modelValue:e(t).aforo_file,"onUpdate:modelValue":i[24]||(i[24]=a=>e(t).aforo_file=a),onAddfile:le,onRemovefile:se,accept_only_pdf:"",files:e(v).III,validator:e(l)},null,8,["modelValue","files","validator"]),n(b,{type:"number",label:"CAPACIDAD (N\xDAMERO DE ASISTENTES) *",tooltip:"Ingrese la capacidad",placeholder:"0...",name:"beneficiaries_capacity",modelValue:e(t).beneficiaries_capacity,"onUpdate:modelValue":i[25]||(i[25]=a=>e(t).beneficiaries_capacity=a),validator:e(l)},null,8,["modelValue","validator"])])):V("",!0),e($)?(g(),x("div",ia,[n(m,{label:"GRUPO *",tooltip:"Selecciona un grupo",placeholder:"Seleccione",name:"group_id",modelValue:e(t).group_id,"onUpdate:modelValue":i[26]||(i[26]=a=>e(t).group_id=a),options:e(f).group_beneficiaries,validator:e(l)},null,8,["modelValue","options","validator"])])):V("",!0),e($)?(g(),x("section",ta,[c("div",null,[c("h3",oa,[la,c("span",null," # "+U(e(t).aggregates.beneficiaries.length),1)])]),c("div",na,[n(Le,{onPop:i[27]||(i[27]=a=>e(s).pop_aggregate(a)),onPush:i[28]||(i[28]=a=>e(s).push_aggregate(a)),options:e(f).beneficiaries_table||null,headers:de,aggregates:e(t).aggregates.beneficiaries,validator:e(l),name:"aggregates"},null,8,["options","aggregates","validator"])])])):V("",!0),c("div",ra,[c("button",{disabled:e(O),class:"btn btn-primary",type:"submit"},U(e(y)?"Actualizar":"Ingresar"),9,sa)])],40,Xe)],8,Ge)])],64))}};export{La as default};
