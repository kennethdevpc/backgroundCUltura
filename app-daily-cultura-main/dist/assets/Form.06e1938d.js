import{m as se,s as S,b as oe,r as D,H as ie,v as le,D as ne,E as N,f as j,g as re,i as r,w as de,j as ce,t as I,l as e,y as me,k as ue,h as o,ad as _e,B as pe,F as ge,q as ve,Q as fe}from"./index.c93647e1.js";import{p as he}from"./psychosocialinstruction.service.f4da92bc.js";import{c as ye}from"./generals.service.ee73141b.js";import{u as be}from"./index.esm.8471a966.js";import{r as d,d as C,o as M,i as Ae,j as $,k as xe}from"./validations.9fff8c5b.js";import{_ as V}from"./Input.d2784565.js";import{_ as Ee}from"./Select.7b4ad9bd.js";import{_ as y}from"./Textarea.8cc31183.js";import{_ as Ie,a as L}from"./Management.8f9978fe.js";import{_ as U}from"./Aggregates.ce7a7b06.js";import{_ as Ve}from"./Radio.33857de6.js";import{h as F}from"./index.esm.c98934a4.js";import{p as T}from"./permissions.c73d0fc1.js";import{s as P}from"./scroll.6a87917e.js";import{_ as Oe}from"./FormHeader.f0e8692c.js";import"./useSlug.fdbf14df.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const Re=se("psychosocialinstruction",{state:()=>({form:{consecutive:"",activity_date:"",nac_id:"",start_time:"",final_hour:"",objective_day:"",themes_day:"",development_activity_image:null,evidence_participation_image:null,development_themes:"",conclusions_reflections_commitments:"",report_followup_alerts:"",aggregates:{assistants:[],monitors:[]}},form_rules:{consecutive:{required:d},activity_date:{required:d},nac_id:{required:d},start_time:{required:d,checkMinMaxHours:C("start_time","final_hour")},final_hour:{required:d,checkMinMaxHours:C("start_time","final_hour")},objective_day:{required:d},themes_day:{required:d},development_activity_image:{required:d},evidence_participation_image:{required:d},development_themes:{required:d},conclusions_reflections_commitments:{required:d},report_followup_alerts:{required:d},aggregates:{assistants:{},monitors:{}}}}),getters:{get_monitors_id:n=>n.form.aggregates.monitors.map(i=>i.id),get_computed_rules:n=>({...n.form_rules,aggregates:{assistants:{requiredIf:F(()=>n.form.aggregates.monitors.length>0)},monitors:{requiredIf:F(()=>n.form.aggregates.assistants.length>0)}}}),transpiled_data(){const{aggregates:n,...i}=this.form;return{...i,added_wizards:n.assistants,assistance_monitors:this.get_monitors_id}}},actions:{push_aggregate(n,i){this.$patch(t=>{i==="a"&&t.form.aggregates.assistants.push(n),i==="m"&&t.form.aggregates.monitors.push(n)})},pop_aggregate(n,i){this.$patch(t=>{if(i==="a"){const p=t.form.aggregates.assistants.findIndex(g=>g.id===n);t.form.aggregates.assistants.splice(p,1)}if(i==="m"){const p=t.form.aggregates.monitors.findIndex(g=>g.id===n);t.form.aggregates.monitors.splice(p,1)}})}}}),we={class:"intro-y box mt-5"},Se=["disabled"],De=["onSubmit"],Ne={id:"general_data",class:"flex flex-col lg:grid lg:grid-cols-1 xl:grid xl:grid-cols-2 gap-6 justify-evenly mb-8"},je={class:"w-full"},Ce={class:"w-full"},Me={class:"w-full"},$e={class:"w-full"},Le={class:"lg:col-span-1 xl:col-span-2"},Ue={class:"lg:col-span-1 xl:col-span-2"},Fe={class:"lg:col-span-1 xl:col-span-2"},Te={class:"lg:col-span-1 xl:col-span-2"},Pe={class:"lg:col-span-1 xl:col-span-2"},He={id:"images",class:"mb-8"},ke={class:"flex flex-col lg:grid lg:grid-cols-2 gap-6 justify-evenly"},Be={id:"asistentes",class:"flex flex-col justify-evenly mb-8"},qe={class:"intro-y form-label font-bold uppercase"},Ge=o("span",null," Asistentes Agregados ",-1),Je={class:"overflow-x-auto overflow-y-hidden"},ze={id:"monitors",class:"flex flex-col justify-evenly mb-8"},Ye={class:"intro-y form-label font-bold uppercase"},Qe=o("span",null," Monitores Agregados ",-1),Xe={class:"overflow-x-auto overflow-y-hidden"},Ke=o("div",null,null,-1),We={class:"flex justify-center"},Ze=["disabled"],Et={__name:"Form",setup(n){const i=Re(),{form:t,get_computed_rules:p}=S(i),g=oe(),{options:_}=S(g);_.value;const m=he(),b=ye(),l=be(p,t,{$autoDirty:!0,$lazy:!0}),A=D([]),x=D([]),H=(c,a)=>{if(c)return;const{file:s,filename:v}=a;t.value.development_activity_image={name:"development_activity_image",file:s,filename:v}},k=()=>{t.value.development_activity_image=null},B=(c,a)=>{if(c)return;const{file:s,filename:v}=a;t.value.evidence_participation_image={name:"evidence_participation_image",file:s,filename:v}},q=()=>{t.value.evidence_participation_image=null},O=ve(),u=ie({consecutive:"",status:"",reject_message:""}),G=async()=>await m.getOne(O.params.id),E=async()=>await b.getConsecutive("psychosocial_instructions","IP").then(c=>{i.form.consecutive=b.data.value,u.consecutive=b.data.value}),h=le(()=>!!O.params.id);ne(async()=>{if(h.value){i.$reset(),await G().catch(()=>{N.not_found_by_id()});const{assistants:c,created_at:a,id:s,monitors:v,nac:et,consecutive:R,status:X,reject_message:K,...W}=m.data.one,Z=c.map(f=>{const{created_at:te,deleted_at:w,id:tt,pivot:at,updated_at:st,...ae}=f;return{...ae}}),ee=v.map(({id:f})=>({..._.value.monitors_table.find(w=>w.id==f)}));i.$patch(f=>{Object.assign(f.form,{...W,consecutive:R,aggregates:{assistants:Z,monitors:ee}})}),u.consecutive=R,u.status=X,u.reject_message=K}else i.$reset(),await E()});const J=[{text:"NOMBRE",value:"assistant_name"},{text:"NUMERO DE C\xC9DULA",value:"assistant_document_number"},{text:"CARGO",value:"assistant_position"},{text:"NAC",value:"nac_id"},{text:"TEL\xC9FONO",value:"assistant_phone"},{text:"EMAIL",value:"assistant_email"}],z={fields:[{name:"assistant_name",as:"input",type:"text",placeholder:"NOMBRE",rules:M},{name:"assistant_document_number",as:"input",type:"text",placeholder:"NUMERO DE C\xC9DULA",rules:Ae},{name:"assistant_position",as:"input",type:"text",placeholder:"CARGO",rules:M},{name:"nac_id",as:"select",placeholder:"NAC",rules:$().required(),children:_.value.nacs.map(c=>({tag:"option",value:c.value,label:c.label}))},{name:"assistant_phone",as:"input",type:"tel",placeholder:"TEL\xC9FONO",rules:xe},{name:"assistant_email",as:"input",type:"text",placeholder:"EMAIL",rules:$().email()}]},Y=[{text:"ID",value:"id"},{text:"NOMBRE COMPLETO",value:"monitor_fullname"},{text:"NUMERO DE C\xC9DULA",value:"document_number"}],Q=async()=>{await l.value.$validate()?h.value?(await m.update(m.data.one.id,i.transpiled_data)).status==200&&(i.$reset(),l.value.$reset(),A.value=[],x.value=[],P()):await E().finally(()=>{m.create(i.transpiled_data).then(async a=>{a.status==200&&(i.$reset(),l.value.$reset(),A.value=[],x.value=[],await E(),P())})}):fe.validation()};return(c,a)=>(j(),re(ge,null,[r(Oe,{state:{consecutive:e(u).consecutive,status:e(u).status,reject_message:e(u).reject_message}},{default:de(()=>[ce(I(e(h)?`Edici\xF3n de Instrucci\xF3n Psicosocial #${e(m).data.one.id}`:"Instrucci\xF3n Psicosocial"),1)]),_:1},8,["state"]),e(h)&&e(T).psychosocialinstructions.management()?(j(),me(Ie,{key:0,class:"mt-5",onSend:a[0]||(a[0]=s=>e(N).methods.send_management("psychosocial_instructions",e(m).data.one.id,s))})):ue("",!0),o("div",we,[o("fieldset",{disabled:e(T).psychosocialinstructions.no_edit()},[o("form",{onSubmit:_e(Q,["prevent"]),class:"p-5 border-t border-slate-200/60"},[o("section",Ne,[o("div",je,[r(V,{type:"date",label:"FECHA *",tooltip:"Ingrese la fecha",placeholder:"Fecha",name:"activity_date",modelValue:e(t).activity_date,"onUpdate:modelValue":a[1]||(a[1]=s=>e(t).activity_date=s),validator:e(l)},null,8,["modelValue","validator"])]),o("div",Ce,[r(Ee,{label:"NAC *",tooltip:"Ingrese el NAC",placeholder:"Seleccione",name:"nac_id",modelValue:e(t).nac_id,"onUpdate:modelValue":a[2]||(a[2]=s=>e(t).nac_id=s),options:e(_).nacs,validator:e(l)},null,8,["modelValue","options","validator"])]),o("div",Me,[r(V,{type:"time",label:"HORA INICIO *",tooltip:"Ingrese la hora de inicio",placeholder:"Hora inicio",name:"start_time",modelValue:e(t).start_time,"onUpdate:modelValue":a[3]||(a[3]=s=>e(t).start_time=s),validator:e(l)},null,8,["modelValue","validator"])]),o("div",$e,[r(V,{type:"time",label:"HORA FINAL *",tooltip:"Ingrese la hora final",placeholder:"Hora final",name:"final_hour",min:e(t).start_time,modelValue:e(t).final_hour,"onUpdate:modelValue":a[4]||(a[4]=s=>e(t).final_hour=s),validator:e(l)},null,8,["min","modelValue","validator"])]),o("div",Le,[r(y,{label:"OBJETIVO DE LA JORNADA *",tooltip:"Ingrese el objetivo de la jornada",placeholder:"Objetivo de la jornada",name:"objective_day",modelValue:e(t).objective_day,"onUpdate:modelValue":a[5]||(a[5]=s=>e(t).objective_day=s),validator:e(l),rows:"5"},null,8,["modelValue","validator"])]),o("div",Ue,[r(y,{label:"TEMAS A TRATAR *",tooltip:"Ingrese los temas a tratar",placeholder:"Temas a tratar",name:"themes_day",modelValue:e(t).themes_day,"onUpdate:modelValue":a[6]||(a[6]=s=>e(t).themes_day=s),validator:e(l),rows:"5"},null,8,["modelValue","validator"])]),o("div",Fe,[r(y,{label:"DESARROLLO DE LOS TEMAS *",tooltip:"Ingrese el desarrollo de los temas",placeholder:"Desarrollo de los temas",name:"development_themes",modelValue:e(t).development_themes,"onUpdate:modelValue":a[7]||(a[7]=s=>e(t).development_themes=s),validator:e(l),rows:"5"},null,8,["modelValue","validator"])]),o("div",Te,[r(y,{label:"CONCLUSIONES Y REFLEXIONES Y COMPROMISOS DE LA JORNADA *",tooltip:"Ingrese las conclusiones y reflexiones y compromisos de la jornada",placeholder:"Conclusiones y reflexiones y compromisos de la jornada",name:"conclusions_reflections_commitments",modelValue:e(t).conclusions_reflections_commitments,"onUpdate:modelValue":a[8]||(a[8]=s=>e(t).conclusions_reflections_commitments=s),validator:e(l),rows:"5"},null,8,["modelValue","validator"])]),o("div",Pe,[r(Ve,{label:"\xBFREPORTE ALERTAS PARA HACER SEGUIMIENTO? *",tooltip:"",name:"report_followup_alerts",modelValue:e(t).report_followup_alerts,"onUpdate:modelValue":a[9]||(a[9]=s=>e(t).report_followup_alerts=s),options:e(_).decisions||null,validator:e(l)},null,8,["modelValue","options","validator"])])]),o("section",He,[o("div",ke,[r(L,{label:"EVIDENCIA DEL DESARROLLO *",tooltip:"Arrastra o selecciona una Imagen o PDF",name:"development_activity_image",ref:"development_activity_image_ref",accept_pdf:!0,modelValue:e(t).development_activity_image,"onUpdate:modelValue":a[10]||(a[10]=s=>e(t).development_activity_image=s),to_edit:e(m).data.one.development_activity_image,onAddfile:H,onRemovefile:k,files:e(A),validator:e(l)},null,8,["modelValue","to_edit","files","validator"]),r(L,{label:"EVIDENCIA DE ACTIVIDAD *",tooltip:"Arrastra o selecciona una Imagen o PDF",name:"evidence_participation_image",ref:"evidence_participation_image_ref",accept_pdf:!0,modelValue:e(t).evidence_participation_image,"onUpdate:modelValue":a[11]||(a[11]=s=>e(t).evidence_participation_image=s),to_edit:e(m).data.one.evidence_participation_image,onAddfile:B,onRemovefile:q,files:e(x),validator:e(l)},null,8,["modelValue","to_edit","files","validator"])])]),o("section",Be,[o("div",null,[o("h3",qe,[Ge,o("span",null," # "+I(e(t).aggregates.assistants.length),1)])]),o("div",Je,[r(U,{onPop:a[12]||(a[12]=s=>e(i).pop_aggregate(s,"a")),onPush:a[13]||(a[13]=s=>e(i).push_aggregate(s,"a")),headers:J,aggregates:e(t).aggregates.assistants,add_schema:z,validator:e(l),name:"aggregates"},null,8,["aggregates","validator"])])]),o("section",ze,[o("div",null,[o("h3",Ye,[Qe,o("span",null," # "+I(e(t).aggregates.monitors.length),1)])]),o("div",Xe,[r(U,{onPop:a[14]||(a[14]=s=>e(i).pop_aggregate(s,"m")),onPush:a[15]||(a[15]=s=>e(i).push_aggregate(s,"m")),headers:Y,aggregates:e(t).aggregates.monitors,options:e(_).monitors_table,validator:e(l),name:"aggregates"},null,8,["aggregates","options","validator"])]),Ke]),o("div",We,[o("button",{disabled:e(pe),type:"submit",class:"btn btn-primary w-24 ml-2"}," Ingresar ",8,Ze)])],40,De)],8,Se)])],64))}};export{Et as default};
