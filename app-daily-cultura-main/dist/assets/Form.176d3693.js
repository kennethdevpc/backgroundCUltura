import{b as te,s as G,m as se,Q as x,a0 as le,d as H,v as $,f,g as w,j as B,t as P,k as O,i as m,w as R,n as oe,l as e,y as J,ac as ie,a9 as ne,r as A,c as re,E as L,N as de,h as r,ad as ce,F as me,q as ue}from"./index.c93647e1.js";import{u as ge}from"./index.esm.8471a966.js";import{m as pe}from"./methodologicalAccompaniments.service.70554991.js";import{p as M}from"./permissions.c73d0fc1.js";import{r as u}from"./validations.9fff8c5b.js";import{h as ve}from"./index.esm.c98934a4.js";import{B as fe,_ as _e}from"./Input.d2784565.js";import{_ as S}from"./Textarea.8cc31183.js";import{_ as be,a as q}from"./Management.8f9978fe.js";import{s as he,_ as ye}from"./Select.7b4ad9bd.js";import{_ as Ve}from"./Aggregates.ce7a7b06.js";import{s as Ee}from"./scroll.6a87917e.js";import{c as Ae}from"./generals.service.ee73141b.js";import{_ as Se}from"./FormHeader.f0e8692c.js";import"./useSlug.fdbf14df.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const xe=te(),{options:v}=G(xe),$e=se("methodologicalAccompaniments",{state:()=>({form:{consecutive:"",date:"",development_activity_image:null,evidence_participation_image:null,nac_id:"",others:"",objective_visit:"",aspects:"",aspects_comments:"",comments:"",aggregates:{assistants:[]},roles:""},form_rules:{date:{required:u},development_activity_image:{required:u},evidence_participation_image:{required:u},nac_id:{required:u},others:{required:u},objective_visit:{required:u},aspects:{required:u},aspects_comments:{required:u},comments:{required:u},aggregates:{assistants:[]},roles:{required:u}},validator:{generalData:!0},form_options:{nacs:v.value.nacs,cultural_rights:v.value.cultural_rights,lineaments:v.value.lineaments,orientations:v.value.orientations,values:v.value.values,users:v.value.users,aspects:v.value.aspects},instance:{status:null,reject_message:null}}),getters:{get_assistants_id:t=>t.form.aggregates.assistants.map(n=>n.id),form_rules_computed:t=>({...t.form_rules,place_image1:t.form.development_activity_image===!1?{}:{required:u},place_image2:t.form.evidence_participation_image===!1?{}:{required:u}}),get_computed_rules:t=>({...t.form_rules,aggregates:{assistants:{requiredIf:ve(()=>t.form.aggregates.assistants.length>0)}}}),transpiled_data(){const{aggregates:t,...n}=this.form;return{...n,assistants:this.get_assistants_id}}},actions:{push_aggregate(t){this.$patch(n=>{n.form.aggregates.assistants.findIndex(d=>d.id===t.id)==-1?n.form.aggregates.assistants.push(t):x.info("Este asistente ya se agrego")})},pop_aggregate(t){this.$patch(n=>{const c=n.form.aggregates.assistants.findIndex(d=>d.id===t);n.form.aggregates.assistants.splice(c,1)})}}});const we={class:"BaseMultiselect"},Be=["for"],Oe={key:0,class:"BaseMultiselect-required"},Ce=H({__name:"Multiselect",props:{validator:null,modelValue:null,labelName:null,label:null,tooltip:{default:""},placeholder:{default:"Seleccione..."},disabled:{type:Boolean,default:!1},name:null,trackBy:null,options:null,searchable:{type:Boolean,default:!0},allowEmpty:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},showLabels:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},taggable:{type:Boolean,default:!1},tagPlaceholder:{default:""},multiple:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},tag:{default:()=>{}},maxHeight:{default:200},hideTooltips:{type:Boolean,default:!1},customLabel:null},emits:["update:modelValue","searchChange"],setup(t,{emit:n}){const c=t,d=g=>{const o=c.tag(g);n("update:modelValue",o)},l=g=>n("searchChange",g),C=g=>{n("update:modelValue",g)},_=$(()=>c.validator[c.name].$errors.length?"border-danger":!1);return(g,o)=>(f(),w("div",we,[t.labelName?(f(),w("label",{key:0,for:t.name,class:"form-label font-bold"},[B(P(t.labelName)+" ",1),t.validator[t.name].required?(f(),w("span",Oe,"*")):O("",!0)],8,Be)):O("",!0),m(e(he),{class:oe(["box-border border rounded",[e(_)]]),name:t.name,"model-value":t.modelValue,options:t.options,searchable:t.searchable,"close-on-select":t.closeOnSelect,"allow-empty":t.allowEmpty,label:t.label,"track-by":t.trackBy,multiple:t.multiple,"max-height":t.maxHeight,placeholder:t.placeholder,"preselect-first":t.preselectFirst,"show-labels":t.showLabels,disabled:t.disabled,loading:t.loading,taggable:t.taggable,"tag-placeholder":t.tagPlaceholder,"custom-label":t.customLabel,onTag:d,onSearchChange:l,"onUpdate:modelValue":C},{noResult:R(()=>[B(" Sin resultados ")]),noOptions:R(()=>[B(" Cargando resultados... ")]),_:1},8,["class","name","model-value","options","searchable","close-on-select","allow-empty","label","track-by","multiple","max-height","placeholder","preselect-first","show-labels","disabled","loading","taggable","tag-placeholder","custom-label"]),t.hideTooltips?O("",!0):(f(),J(fe,ie(ne({key:1},{name:t.name,validator:t.validator,tooltip:t.tooltip})),null,16))]))}});var z=le(Ce,[["__scopeId","data-v-5d90c8ad"]]);const Ne={class:"intro-y box mt-5"},Ie=["disabled"],Pe=["onSubmit"],Re={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},Te={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},Ue={class:"grid gap-5 grid-cols-1"},je={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},Fe={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},De={id:"asistentes",class:"flex flex-col justify-evenly mb-8"},ke={class:"intro-y form-label font-bold uppercase"},Le=r("span",null," Asistentes Agregados ",-1),Me={class:"overflow-x-auto overflow-y-hidden"},qe={class:"flex justify-center"},ze=["disabled"],ca=H({__name:"Form",setup(t){const n=Ae(),c=pe(),d=$e(),{form:l,form_rules:C,form_options:_,instance:g}=G(d),o=ge(C,l,{$autoDirty:!0,$lazy:!0}),b=ue(),T=$(()=>!!b.params.id),h=A([]),N=A([]),y=A({development_activity_image:[],evidence_participation_image:[]}),U=$(()=>!!b.params.id),Q=async()=>await c.getOne(b.params.id),K=[{text:"ID",value:"id"},{text:"NOMBRE COMPLETO",value:"monitor_fullname"},{text:"NUMERO DE C\xC9DULA",value:"document_number"}];re(async()=>{await E(),U.value?(d.$reset(),o.value.$reset(),await Q().then(()=>{const{created_at:i,status:a,assistants:s,roles_associate:p,reject_message:I,...Z}=c.data.one;d.$patch(ee=>{Object.assign(ee.form,{...Z,aggregates:{assistants:s.map(({pivot:Ge,...ae})=>({...ae}))},roles:p})}),g.value.status=a,g.value.reject_message=I}).catch(()=>{L.not_found_by_id()})):(d.$reset(),o.value.$reset(),await E())});const V=A(!1),W=async()=>{await o.value.$validate()?(V.value=!0,U.value?await c.update(c.data.one.id,d.transpiled_data).finally(()=>{V.value=!1}):await E().finally(()=>{c.create(d.transpiled_data).then(async a=>{a.data.success&&(y.value.development_activity_image=[],y.value.evidence_participation_image=[],d.$reset(),o.value.$reset(),Ee(),await E())}).finally(()=>{V.value=!1})})):x.validation()},j=(i,a,s)=>{if(i)return;const{file:p,filename:I}=a;l.value[s]={name:"photo1",file:p,filename:I}},F=i=>{l.value[i]=null},D=(i,a)=>a.length>0?a.find(s=>s.value==i).label:"Sin Datos",k=i=>i.length>0?i.map(a=>a.value):[],E=async()=>await n.getConsecutive("methodological_accompaniments","MA").then(()=>{l.value.consecutive=n.data.value}),X=$(()=>l.value.nac_id);de(X,async(i,a)=>{i!=""&&i!=null&&i!=a&&await Y(i)});const Y=async i=>{await n.getProfileRoleUserNac(i).then(a=>{if(a!=null){let s=a.data.items.original.assistants,p=a.data.items.original.roles;p.length>0?h.value=p:(x.personalized("El nac seleccionado no pose\xE9 roles.","info"),h.value=[]),s.length>0?N.value=s:(N.value=[],x.personalized("El nac seleccionado no pose\xE9 asistentes.","info"),l.value.aggregates.assistants=[])}})};return(i,a)=>(f(),w(me,null,[m(Se,{state:{consecutive:e(l).consecutive,status:e(g).status,reject_message:e(g).reject_message}},{default:R(()=>[B(P(e(T)?`Edici\xF3n de Acompa\xF1amiento Metodologico (visitas) #${e(b).params.id}`:"Acompa\xF1amiento Metodologico (visitas)"),1)]),_:1},8,["state"]),e(T)&&e(M).methodologicalAccompaniments.management()?(f(),J(be,{key:0,onSend:a[0]||(a[0]=s=>e(L).methods.send_management("methodological_accompaniments",e(b).params.id,s)),class:"mt-5"})):O("",!0),r("div",Ne,[r("fieldset",{disabled:e(M).methodologicalAccompaniments.no_edit()},[r("form",{onSubmit:ce(W,["prevent"]),class:"grid gap-3 grid-cols-1 p-5 border-t border-slate-200/60"},[r("section",Re,[m(_e,{type:"date",label:"FECHA *",name:"date",placeholder:"Fecha",modelValue:e(l).date,"onUpdate:modelValue":a[1]||(a[1]=s=>e(l).date=s),validator:e(o)},null,8,["modelValue","validator"]),m(ye,{label:"NAC *",tooltip:"Ingrese el NAC",placeholder:"Seleccione",name:"nac_id",modelValue:e(l).nac_id,"onUpdate:modelValue":a[2]||(a[2]=s=>e(l).nac_id=s),options:e(_).nacs,validator:e(o)},null,8,["modelValue","options","validator"])]),r("section",Te,[m(z,{validator:e(o),name:"roles",modelValue:e(l).roles,"onUpdate:modelValue":a[3]||(a[3]=s=>e(l).roles=s),options:k(e(h)),"custom-label":s=>D(s,e(h)),"label-name":"ROLES ",multiple:""},null,8,["validator","modelValue","options","custom-label"]),m(z,{validator:e(o),name:"aspects",modelValue:e(l).aspects,"onUpdate:modelValue":a[4]||(a[4]=s=>e(l).aspects=s),options:k(e(_).aspects),"custom-label":s=>D(s,e(_).aspects),"label-name":"ASPECTOS PREVIOS A TENER EN CUENTA",multiple:""},null,8,["validator","modelValue","options","custom-label"])]),r("section",Ue,[m(S,{label:"OTROS: \xBFCUAL?",placeholder:"Descripci\xF3n",name:"others",modelValue:e(l).others,"onUpdate:modelValue":a[5]||(a[5]=s=>e(l).others=s),validator:e(o),rows:"3"},null,8,["modelValue","validator"]),m(S,{label:"OBJETIVO DE LA VISITA: *",placeholder:"Objetivo de la visita",name:"objective_visit",modelValue:e(l).objective_visit,"onUpdate:modelValue":a[6]||(a[6]=s=>e(l).objective_visit=s),validator:e(o),rows:"3"},null,8,["modelValue","validator"])]),r("section",je,[m(S,{class:"col-span-full",label:"ASPECTOS PREVIOS A TENER EN CUENTA: *",placeholder:"Aspectos previos a tener en cuenta",name:"aspects_comments",modelValue:e(l).aspects_comments,"onUpdate:modelValue":a[7]||(a[7]=s=>e(l).aspects_comments=s),validator:e(o),rows:"3"},null,8,["modelValue","validator"]),m(S,{class:"col-span-full",label:"OBSERVACIONES *",placeholder:"Observaciones",name:"comments",modelValue:e(l).comments,"onUpdate:modelValue":a[8]||(a[8]=s=>e(l).comments=s),validator:e(o),rows:"3"},null,8,["modelValue","validator"])]),r("section",Fe,[m(q,{label:"FOTO DEL DESARROLLO *",tooltip:"Arrastra una imagen JPG/PNG",name:"development_activity_image",ref:"development_activity_image",files:e(y).development_activity_image,validator:e(o),onAddfile:a[9]||(a[9]=(s,p)=>j(s,p,"development_activity_image")),onRemovefile:a[10]||(a[10]=s=>F("development_activity_image")),to_edit:e(c).data.one.development_activity_image,modelValue:e(l).development_activity_image,"onUpdate:modelValue":a[11]||(a[11]=s=>e(l).development_activity_image=s)},null,8,["files","validator","to_edit","modelValue"]),m(q,{label:"EVIDENCIA DE PARTICIPACI\xD3N *",tooltip:"Arrastra una imagen JPG/PNG",name:"evidence_participation_image",ref:"evidence_participation_image",files:e(y).evidence_participation_image,validator:e(o),onAddfile:a[12]||(a[12]=(s,p)=>j(s,p,"evidence_participation_image")),onRemovefile:a[13]||(a[13]=s=>F("evidence_participation_image")),to_edit:e(c).data.one.evidence_participation_image,modelValue:e(l).evidence_participation_image,"onUpdate:modelValue":a[14]||(a[14]=s=>e(l).evidence_participation_image=s)},null,8,["files","validator","to_edit","modelValue"])]),r("section",De,[r("div",null,[r("h3",ke,[Le,r("span",null," # "+P(e(l).aggregates.assistants.length),1)])]),r("div",Me,[m(Ve,{onPop:a[15]||(a[15]=s=>e(d).pop_aggregate(s)),onPush:a[16]||(a[16]=s=>e(d).push_aggregate(s)),headers:K,aggregates:e(l).aggregates.assistants,options:e(N),validator:e(o),name:"aggregates"},null,8,["aggregates","options","validator"])])]),r("div",qe,[r("button",{type:"submit",class:"btn btn-primary w-24 mr-1 mb-2",disabled:e(V)}," Ingresar ",8,ze)])],40,Pe)],8,Ie)])],64))}});export{ca as default};
