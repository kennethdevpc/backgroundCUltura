import{m as de,d as ue,O as V,s as B,E as P,b as ce,r as f,H as me,c as pe,ao as _e,v as E,N as q,f as L,g as G,i as n,w as ve,j as ge,t as N,l as e,y as fe,k as H,h as l,ad as be,F as he,q as ye,aw as Ve,an as Ie}from"./index.c93647e1.js";import{s as xe}from"./scroll.6a87917e.js";import{p as M}from"./permissions.c73d0fc1.js";import{c as Se}from"./generals.service.ee73141b.js";import{_ as Ae}from"./Aggregates.ce7a7b06.js";import{c as Ee}from"./culturalSeedbeds.service.29180826.js";import{p as Oe}from"./pecs.service.c1afe54a.js";import{u as Ce}from"./index.esm.8471a966.js";import{_ as U}from"./Input.d2784565.js";import{_}from"./Select.7b4ad9bd.js";import{_ as O}from"./Textarea.8cc31183.js";import{_ as De,a as k}from"./Management.8f9978fe.js";import{r,g as we,m as Re}from"./validations.9fff8c5b.js";import{e as $e}from"./es.d3f7231d.js";import{l as Le}from"./localeData.68a39605.js";import{u as Ne}from"./methodologicalSheetsOne.service.ccdd648f.js";import{_ as Me}from"./FormHeader.f0e8692c.js";import{u as Ue}from"./useApi.3f746542.js";import"./index.37cca9d1.js";import"./useSlug.fdbf14df.js";import"./index.esm.c98934a4.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const J={date:"",last_status:"",status:"",consecutive:"",pec_id:"",datasheet_planning_id:"",filter_level:"",quantity_members:"",level_domain_description:"",objective_process:"",cultural_right_id:"",lineament_id:"",orientation_id:"",values:"",artistic_expertise:"",observations:"",development_activity_image:null,evidence_participation_image:null,group_id:"",aggregates:{beneficiaries:[]},datasheet:null},Te=de("seed_beds",{state:()=>({form:Object.assign({},J),form_rules:{date:{required:r},pec_id:{required:r},datasheet_planning_id:{required:r},filter_level:{required:r},quantity_members:{required:r,minValue:we(0)},level_domain_description:{required:r},objective_process:{required:r},cultural_right_id:{required:r},lineament_id:{required:r},orientation_id:{required:r},values:{required:r},artistic_expertise:{required:r},observations:{required:r},development_activity_image:{required:r},evidence_participation_image:{required:r},group_id:{required:r},aggregates:{beneficiaries:{required:r,minLength:Re(1)}},datasheet:{required:r}},validator:{generalData:!0},filesOne:{development_activity_image:null,evidence_participation_image:null}}),actions:{push_aggregate(p){this.$patch(c=>{c.form.aggregates.beneficiaries.push(p)})},pop_aggregate(p){this.$patch(c=>{const m=c.form.aggregates.beneficiaries.findIndex(i=>i.id===p);c.form.aggregates.beneficiaries.splice(m,1)})},toggleGeneralData(p){this.$patch(c=>{c.validator.generalData=p})},async clear(){Object.assign(this.form,J)}},getters:{isValid:p=>!!p.validator.generalData,transpiledData(){return{...this.form}}}}),je={class:"intro-y box mt-5"},Fe=["disabled"],Be=["onSubmit"],Pe={class:"flex flex-col lg:grid lg:grid-cols-2 xl:grid xl:grid-cols-2 gap-6 justify-evenly"},qe={class:"flex flex-col lg:grid lg:grid-cols-2 xl:grid xl:grid-cols-2 gap-6 justify-evenly"},Ge={class:"w-full"},He={class:"w-full"},ke={class:"w-full"},Je={class:"w-full"},Ye={class:"grid grid-cols-1 gap-6 justify-evenly"},ze={class:"w-full"},Xe={class:"w-full"},Ze=l("div",{class:"intro-y flex justify-between items-start md:items-end mt-5"},[l("div",{class:"intro-y flex flex-col items-start gap-1"},[l("h2",{class:"text-lg font-medium mr-auto"}," COMPONENTE METADOLOGICO ")])],-1),Ke={class:"flex flex-col lg:grid lg:grid-cols-2 xl:grid xl:grid-cols-2 gap-6 justify-evenly"},Qe={class:"w-full mt-5"},We={class:"w-full mt-5"},et={class:"w-full mt-5"},tt={class:"w-full mt-5"},at={class:"w-full"},it={class:"w-full"},lt={class:"flex flex-col lg:grid lg:grid-cols-2 gap-6 justify-evenly"},ot={class:"w-full"},st={class:"flex flex-col justify-start mb-8"},nt={class:"intro-y form-label font-bold uppercase"},rt=l("span",null," Asistentes Agregados ",-1),dt={key:0,class:"flex justify-center"},ut=["disabled"],Mt=ue({__name:"Form",setup(p){const{find:c}=Ue();V.locale($e),V.extend(Le);const m=Te(),{form:i,form_rules:Y,filesOne:I}=B(m),{is_role:b}=P.computed,z=Ne(),X=ce(),{options:v}=B(X),C=Ee(),D=Se(),Z=ye(),T=f([]),u=Z.params.id,w=f([]),x=f(!1),S=me({I:[],II:[]}),s=Ce(Y,i,{$autoDirty:!0,$lazy:!0}),A=f({status:"",reject_message:""}),K=(o,a)=>{if(o)return;const{file:t,filename:d}=a;i.value.development_activity_image=t},Q=()=>{i.value.development_activity_image=null},W=(o,a)=>{if(o)return;const{file:t,filename:d}=a;i.value.evidence_participation_image=t},ee=()=>{i.value.evidence_participation_image=null},te=async()=>{let{data:o}=await z.get();o.items.map(a=>{T.value.push({label:`${a.consecutive}${a.id} | ${a.date_ini} al ${a.date_fin}`,value:a.id})})},j=f("");pe(async()=>{var o,a;if(m.$reset(),await te(),w.value=v.value.group_beneficiaries,u){const{data:{items:t}}=await C.getOne(u),{datasheet_planning:d,beneficiaries:h,created_by:g,...$}=t;j.value=g==null?void 0:g.id;const re=((o=t==null?void 0:t.beneficiaries)==null?void 0:o.map(y=>({full_name:y.full_name,id:y.id,nuip:y.document_number})))||[];if(I.value.development_activity_image=$.development_activity_image,I.value.evidence_participation_image=$.evidence_participation_image,i.value={...$,datasheet_planning_id:d==null?void 0:d.id},b("lider_instructor")||b("apoyo_seguimiento_monitoreo")){const y=await D.getGroupsCreatedBy((a=t==null?void 0:t.created_by)==null?void 0:a.id);w.value=y.data}A.value.reject_message=t==null?void 0:t.reject_message,A.value.status=t==null?void 0:t.status,i.value.aggregates={beneficiaries:re}}else await R()});const R=async()=>{let{data:o}=await D.getConsecutive("cultural_seedbeds","BCC");i.value.consecutive=o},ae=async()=>{if(await s.value.$validate()){x.value=!0;const{...a}=i.value,t={...a,aggregates:JSON.stringify(i.value.aggregates.beneficiaries.map(d=>d.id))};u?await C.update(u,t).then(async d=>{Ve.push({name:"culturalSeedbeds.index"})}).finally(()=>{x.value=!1}):await R().finally(()=>{t.datasheet_planning_id=i.value.datasheet_planning_id,C.create(t).then(async d=>{await m.clear(),m.$reset(),i.value.aggregates.beneficiaries=[],s.value.$reset(),await R(),xe(),S.I=[],S.II=[]}).finally(()=>{x.value=!1})})}else Ie.fire("Validaci\xF3n","Por favor valide los campos solicitados.","error")};function F(o){const[a,t]=o.split(":"),d=a>=12?"PM":"AM";return`${a%12||12}:${t} ${d}`}const ie=_e(async()=>{const o=await Oe().byActivityDate(),{items:a}=o.data;return a.map(t=>({value:t.id,label:`${t.consecutive} - ${V(t.activity_date).format("DD/MM/YYYY")} - ${F(t.start_time)} - ${F(t.final_hour)}`}))},null),le=[{text:"ID",value:"id"},{text:"NOMBRE",value:"full_name"},{text:"C\xC9DULA",value:"nuip"}],oe=f([]),se=async o=>{await D.getGroupBeneficiaries(o,j.value).then(a=>{if(a!=null){let t=a.data.items[0].beneficiaries;oe.value=t,m.$patch(d=>{d.form.aggregates.beneficiaries=t})}})},ne=E(()=>i.value.group_id);return q(ne,async(o,a)=>{o!=""&&o!=null&&o!=a&&await se(o)}),(b("instructor")||b("super.root")||b("root"))&&q(E(()=>i.value.date),async(o,a)=>{if(o!=null&&a!=""&&i.value.date){i.value.datasheet="Cargando...";const t=await c(`getDataSheet/cultural_seedbeds/${i.value.date}/date`).then(g=>g.data),d=V(i.value.date).format("MMMM"),h=E(()=>`Circulaci\xF3n ${t} - ${d}`);i.value.datasheet=h.value}if(!u){i.value.datasheet="Cargando...";const t=await c(`getDataSheet/cultural_seedbeds/${i.value.date}/date`).then(g=>g.data),d=V(i.value.date).format("MMMM"),h=E(()=>`Circulaci\xF3n ${t} - ${d}`);i.value.datasheet=h.value}}),(o,a)=>(L(),G(he,null,[n(Me,{state:{consecutive:e(i).consecutive,status:e(A).status,reject_message:e(A).reject_message}},{default:ve(()=>[ge(N(e(u)?`EDICI\xD3N BIT\xC1CORA SEMILLERO CULTURAL #${e(u)}`:"BIT\xC1CORA SEMILLERO CULTURAL"),1)]),_:1},8,["state"]),e(u)&&e(M).culturalSeddbeds.management()?(L(),fe(De,{key:0,onSend:a[0]||(a[0]=t=>e(P).methods.send_management("cultural_seedbeds",e(u),t)),class:"mt-5"})):H("",!0),l("div",je,[l("fieldset",{disabled:e(M).culturalSeddbeds.no_edit()},[l("form",{onSubmit:be(ae,["prevent"]),class:"p-5 border-t border-slate-200/60 space-y-8"},[l("section",Pe,[n(U,{type:"date",label:"FECHA *",tooltip:"Ingrese la fecha",placeholder:"Fecha",name:"date",modelValue:e(i).date,"onUpdate:modelValue":a[1]||(a[1]=t=>e(i).date=t),validator:e(s)},null,8,["modelValue","validator"]),n(U,{name:"datasheet",type:"text",label:"FICHA NO. *",disabled:"",validator:e(s),modelValue:e(i).datasheet,"onUpdate:modelValue":a[2]||(a[2]=t=>e(i).datasheet=t)},null,8,["validator","modelValue"])]),l("section",qe,[l("div",Ge,[n(_,{label:"FILTRO PEC *",tooltip:"Filtro pec *",placeholder:"Seleccione",name:"pec_id",modelValue:e(i).pec_id,"onUpdate:modelValue":a[3]||(a[3]=t=>e(i).pec_id=t),options:e(ie),validator:e(s)},null,8,["modelValue","options","validator"])]),l("div",He,[n(_,{label:"FICHAS DE PLANEACION *",tooltip:"Fichas de planeacion *",placeholder:"Seleccione",name:"datasheet_planning_id",modelValue:e(i).datasheet_planning_id,"onUpdate:modelValue":a[4]||(a[4]=t=>e(i).datasheet_planning_id=t),options:e(T),validator:e(s)},null,8,["modelValue","options","validator"])]),l("div",ke,[n(_,{label:"NIVEL DE DOMINIO DEL SEMILLERO *",tooltip:"Nivel de dominio *",placeholder:"Seleccione",name:"filter_level",modelValue:e(i).filter_level,"onUpdate:modelValue":a[5]||(a[5]=t=>e(i).filter_level=t),options:e(v).filter_level,validator:e(s)},null,8,["modelValue","options","validator"])]),l("div",Je,[n(U,{type:"number",label:"CANTIDAD DE INTEGRANTES DEL SEMILLERO *",tooltip:"Cantidad de integrantes ",placeholder:"Ingrese",name:"quantity_members",modelValue:e(i).quantity_members,"onUpdate:modelValue":a[6]||(a[6]=t=>e(i).quantity_members=t),validator:e(s)},null,8,["modelValue","validator"])])]),l("section",Ye,[l("div",ze,[n(O,{label:"DESCRIPCION NIVEL DE DOMINIO *",tooltip:"Ingrese el nivel de dominio",placeholder:"Ingrese",name:"level_domain_description",modelValue:e(i).level_domain_description,"onUpdate:modelValue":a[7]||(a[7]=t=>e(i).level_domain_description=t),validator:e(s),rows:"5"},null,8,["modelValue","validator"])]),l("div",Xe,[n(O,{label:"OBJETIVO VIVENCIAL DE LA JORNADA *",tooltip:"Ingrese el objetivo",placeholder:"Ingrese",name:"objective_process",modelValue:e(i).objective_process,"onUpdate:modelValue":a[8]||(a[8]=t=>e(i).objective_process=t),validator:e(s),rows:"5"},null,8,["modelValue","validator"])]),Ze,l("section",Ke,[l("div",Qe,[n(_,{label:"DERECHO CULTURAL *",tooltip:"Selecciona el derecho cultural",placeholder:"Seleccione",name:"cultural_right_id",modelValue:e(i).cultural_right_id,"onUpdate:modelValue":a[9]||(a[9]=t=>e(i).cultural_right_id=t),options:e(v).cultural_rights,validator:e(s)},null,8,["modelValue","options","validator"])]),l("div",We,[n(_,{label:"LINEAMIENTO *",tooltip:"Selecciona eL lineamiento",placeholder:"Seleccione",name:"lineament_id",modelValue:e(i).lineament_id,"onUpdate:modelValue":a[10]||(a[10]=t=>e(i).lineament_id=t),options:e(v).lineaments,validator:e(s)},null,8,["modelValue","options","validator"])]),l("div",et,[n(_,{label:"ORIENTACIONES *",tooltip:"Seleccione la orientacion",placeholder:"Seleccione",name:"orientation_id",modelValue:e(i).orientation_id,"onUpdate:modelValue":a[11]||(a[11]=t=>e(i).orientation_id=t),options:e(v).orientations,validator:e(s)},null,8,["modelValue","options","validator"])]),l("div",tt,[n(_,{label:"VALOR *",tooltip:"Selecciona el valor",placeholder:"Seleccione",name:"values",modelValue:e(i).values,"onUpdate:modelValue":a[12]||(a[12]=t=>e(i).values=t),options:e(v).values,validator:e(s)},null,8,["modelValue","options","validator"])]),l("div",at,[n(O,{label:"EXPERTICIA ART\xCDSTICA A TRABAJAR:*",tooltip:"Ingrese la experticia",placeholder:"Ingrese",name:"artistic_expertise",modelValue:e(i).artistic_expertise,"onUpdate:modelValue":a[13]||(a[13]=t=>e(i).artistic_expertise=t),validator:e(s),rows:"5"},null,8,["modelValue","validator"])]),l("div",it,[n(O,{label:"OBSERVACIONES DE LA REALIZACI\xD3N:*",tooltip:"Ingrese la observaci\xF3n",placeholder:"Ingrese",name:"observations",modelValue:e(i).observations,"onUpdate:modelValue":a[14]||(a[14]=t=>e(i).observations=t),validator:e(s),rows:"5"},null,8,["modelValue","validator"])])])]),l("section",lt,[n(k,{label:"FOTO DEL DESARROLLO *",tooltip:"Arrastra o selecciona una Imagen",name:"development_activity_image",ref:"development_activity_image_ref",to_edit:e(I).development_activity_image,modelValue:e(i).development_activity_image,"onUpdate:modelValue":a[15]||(a[15]=t=>e(i).development_activity_image=t),onAddfile:K,onRemovefile:Q,files:e(S).I,validator:e(s)},null,8,["to_edit","modelValue","files","validator"]),n(k,{label:"EVIDENCIA DE PARTICIPACI\xD3N *",tooltip:"Arrastra o selecciona una Imagen",name:"evidence_participation_image",ref:"evidence_participation_image_ref",to_edit:e(I).evidence_participation_image,modelValue:e(i).evidence_participation_image,"onUpdate:modelValue":a[16]||(a[16]=t=>e(i).evidence_participation_image=t),onAddfile:W,onRemovefile:ee,files:e(S).II,validator:e(s)},null,8,["to_edit","modelValue","files","validator"])]),l("div",ot,[n(_,{label:"GRUPO *",tooltip:"Selecciona un grupo",placeholder:"Seleccione",name:"group_id",modelValue:e(i).group_id,"onUpdate:modelValue":a[17]||(a[17]=t=>e(i).group_id=t),options:e(w),validator:e(s)},null,8,["modelValue","options","validator"])]),l("section",st,[l("div",null,[l("h3",nt,[rt,l("span",null," # "+N(e(i).aggregates.beneficiaries.length),1)])]),n(Ae,{onPop:a[18]||(a[18]=t=>e(m).pop_aggregate(t)),onPush:a[19]||(a[19]=t=>e(m).push_aggregate(t)),options:e(v).beneficiaries_table||null,headers:le,aggregates:e(i).aggregates.beneficiaries,validator:e(s),name:"aggregates"},null,8,["options","aggregates","validator"])]),e(M).culturalSeddbeds.no_edit()?H("",!0):(L(),G("div",dt,[l("button",{disabled:e(x),type:"submit",class:"btn btn-primary w-24 ml-2"},N(e(u)?"Actualizar":"Ingresar"),9,ut)]))],40,Be)],8,Fe)])],64))}});export{Mt as default};
