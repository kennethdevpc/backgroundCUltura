import{m as oe,K as w,d as le,O as S,b as ne,H as ie,s as se,v as V,C as U,r as y,D as re,ao as de,N as M,f as L,g as me,i,w as ue,j as ge,t as ce,l as e,y as pe,E as _e,k as ve,h as n,ad as fe,F as Ve,u as he,q as be,P as O,Q as $}from"./index.c93647e1.js";import{r as s,c as x}from"./validations.9fff8c5b.js";import{u as ye}from"./index.esm.8471a966.js";import{e as Oe}from"./es.d3f7231d.js";import{l as xe}from"./localeData.68a39605.js";import{_ as A}from"./Input.d2784565.js";import{_ as c}from"./Select.7b4ad9bd.js";import{_ as E}from"./Textarea.8cc31183.js";import{_ as Ae,a as j}from"./Management.8f9978fe.js";import{u as Ee}from"./useApi.3f746542.js";import{_ as Ce}from"./Aggregates.ce7a7b06.js";import{s as Re}from"./scroll.6a87917e.js";import{p as P}from"./permissions.c73d0fc1.js";import{_ as De}from"./FormHeader.f0e8692c.js";import"./index.esm.c98934a4.js";import"./useSlug.fdbf14df.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const Se=oe("methodologicalMonitorings",{state:()=>({form:{consecutive:"",datasheet:"",roles:"",nac_id:"",date_realization:"",date_planning_ini:"",date_planning_fin:"",cultural_right_id:"",lineament_id:"",orientation_id:"",value:"",objective_process:"",comments:"",strengthening_type:"",strengthening_comments:"",topics_to_strengthened:"",development_activity_image:null,evidence_participation_image:null,aggregates:[]}}),getters:{form_rules(){return{consecutive:{required:s},datasheet:{required:s},roles:{required:s},nac_id:{required:s},date_realization:{required:s},date_planning_ini:{required:s},date_planning_fin:{required:s},cultural_right_id:{required:s},lineament_id:{required:s},orientation_id:{required:s},value:{required:s},objective_process:{required:s,alphaOrAlphanumeric:x},comments:{required:s,alphaOrAlphanumeric:x},strengthening_type:{required:s},strengthening_comments:{required:s,alphaOrAlphanumeric:x},topics_to_strengthened:{required:s,alphaOrAlphanumeric:x},development_activity_image:{required:s},evidence_participation_image:{required:s},aggregates:{required:s}}},transpiledData(m){return{...m.form,roles:m.form.roles.toString(),aggregates:m.form.aggregates.map(u=>u.id).toString()}}},actions:{}}),z="api/v1";function Me(){return{getFromTable:d=>w.get(`/${z}/selectFromTable?table=${d}`),getFromDefaults:d=>w.get(`/${z}/selectFromDefaults?select=${d}`)}}const $e=m=>{const u=new FormData;for(const[d,C]of Object.entries(m))u.append(d,C);return u},Fe={class:"p-5 mt-5 intro-y box"},Ie=["disabled"],Ne=["onSubmit"],Te=n("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Datos Generales ",-1),we={class:"mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2"},Ue={class:"col-span-1"},Le=n("label",{for:"initial",class:"form-label font-bold"}," FECHA RANGO PLANEACI\xD3N * ",-1),je={class:"grid grid-cols-[1fr_auto_1fr] items-center gap-x-2"},Pe=n("span",{class:"mb-1"}," A ",-1),ze={class:"pt-8"},Be=n("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Componente Metodol\xF3gico ",-1),ke={class:"mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2"},He={class:"col-span-1 sm:col-span-2"},Ge={class:"col-span-1 sm:col-span-2"},qe={class:"col-span-1 sm:col-span-2"},Je={class:"pt-8"},Ke=n("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Asistentes Agregados ",-1),Qe={class:"mt-6 grid grid-cols-1"},We=n("div",{class:"pt-5"},[n("div",{class:"flex justify-end gap-x-4"},[n("button",{type:"submit",class:"btn btn-primary"}," Guardar ")])],-1),Ct=le({__name:"Form",setup(m){S.locale(Oe),S.extend(xe);const{getFromDefaults:u}=Me(),{find:d,findOne:C,create:F,update:B}=Ee(),_=Se(),{options:{lineaments:k,cultural_rights:H,orientations:G,values:q,nacs:J}}=ne(),K=he(),v=be(),f=ie({consecutive:"",status:"",reject_message:""}),{form:t,form_rules:Q}=se(_),l=ye(Q,t),g=V(()=>!!v.params.id),{state:h}=U(async()=>(l.value.$reset(),_.$reset(),g.value?(O(!0),await C("methodologicalMonitorings",v.params.id).then(o=>{const{aggregates:a,audited:p,consecutive:T,created_at:Xe,created_by:Ye,cultural_right:Ze,id:et,lineament:tt,nac:at,orientation:ot,reject_message:Z,roles:lt,status:ee,user:nt,value:it,value_id:te,...ae}=o.data.items;return Object.assign(f,{consecutive:T,status:ee,reject_message:Z}),Object.assign(t.value,{...ae,consecutive:T,value:te}),o.data.items}).finally(()=>{O(!1)})):null),null),I=y();re(async()=>{await d("getRole").then(r=>{r.data.length>0?I.value=r.data:t.value.roles=null})});const W=de(async()=>(await u("strengthening_types")).data,null),{execute:N}=U(async()=>{if(!g.value){const r=await d("consecutive/generate/methodological_monitorings/SML");return t.value.consecutive=r.data,f.consecutive=r.data,r.data}},null),b=y([]);M(V(()=>t.value.date_realization),async()=>{if(t.value.date_realization){t.value.datasheet="Cargando...";const r=await d(`getDataSheet/methodological_monitorings/${t.value.date_realization}`).then(p=>p.data),o=S(t.value.date_realization).format("MMMM"),a=V(()=>`Seguimiento ${r} - ${o}`);t.value.datasheet=a.value}});const X=[{text:"ID",value:"id"},{text:"NOMBRE",value:"full_name"},{text:"C\xC9DULA",value:"nuip"}];var R=y([]);const D=y([]);M(V(()=>t.value.roles),async()=>{t.value.roles&&(R.value=await F("getRolesUsers",{roles:t.value.roles}).then(r=>Object.entries(r.data).map(([o,a])=>({value:a.id,id:a.id,full_name:a.monitor_fullname,nuip:a.document_number,roleId:a.role_id})))),t.value.roles.length&&R.value.length?D.value=R.value.filter(r=>t.value.roles.includes(r.roleId)):(D.value=[],t.value.aggregates=[])}),M(V(()=>t.value.roles),()=>{});async function Y(){if(await l.value.$validate()){O(!0);const o=$e(_.transpiledData);g.value?await B("methodologicalMonitorings",v.params.id,o).then(a=>{a.status>=200&&a.status<=300&&($.update(),b.value=[],_.$reset(),l.value.$reset(),K.go(-1))}):await N().finally(()=>{F("methodologicalMonitorings",o).then(async a=>{a.status>=200&&a.status<=300&&($.create(),b.value=[],_.$reset(),l.value.$reset(),await N().finally(()=>{O(!1),Re()}))})})}else $.validation()}return(r,o)=>(L(),me(Ve,null,[i(De,{state:{consecutive:e(f).consecutive,status:e(f).status,reject_message:e(f).reject_message}},{default:ue(()=>[ge(ce(e(g)?`Edici\xF3n de Seguimiento Metodol\xF3gico #${e(v).params.id}`:"Seguimiento Metodol\xF3gico"),1)]),_:1},8,["state"]),e(g)&&e(P).methodologicalMonitorings.management()?(L(),pe(Ae,{key:0,onSend:o[0]||(o[0]=a=>e(_e).methods.send_management("methodological_monitorings",e(v).params.id,a)),class:"mt-5"})):ve("",!0),n("div",Fe,[n("fieldset",{disabled:e(P).methodologicalMonitorings.no_edit()},[n("form",{onSubmit:fe(Y,["prevent"]),class:"space-y-8 divide-y divide-slate-200"},[n("div",null,[Te,n("div",we,[i(A,{name:"date_realization",type:"date",label:"FECHA *",validator:e(l),modelValue:e(t).date_realization,"onUpdate:modelValue":o[1]||(o[1]=a=>e(t).date_realization=a)},null,8,["validator","modelValue"]),i(A,{name:"datasheet",type:"text",label:"FICHA NO. *",disabled:"",validator:e(l),modelValue:e(t).datasheet,"onUpdate:modelValue":o[2]||(o[2]=a=>e(t).datasheet=a)},null,8,["validator","modelValue"]),i(c,{name:"nac_id",label:"NAC *",options:e(J),validator:e(l),modelValue:e(t).nac_id,"onUpdate:modelValue":o[3]||(o[3]=a=>e(t).nac_id=a)},null,8,["options","validator","modelValue"]),i(c,{name:"roles",label:"ROL *",placeholder:"Roles relacionados al NAC",multiple:"",hideSelected:"",options:e(I),validator:e(l),modelValue:e(t).roles,"onUpdate:modelValue":o[4]||(o[4]=a=>e(t).roles=a)},null,8,["options","validator","modelValue"]),n("div",Ue,[Le,n("div",je,[i(A,{name:"date_planning_ini",type:"date",validator:e(l),modelValue:e(t).date_planning_ini,"onUpdate:modelValue":o[5]||(o[5]=a=>e(t).date_planning_ini=a)},null,8,["validator","modelValue"]),Pe,i(A,{name:"date_planning_fin",type:"date",validator:e(l),modelValue:e(t).date_planning_fin,"onUpdate:modelValue":o[6]||(o[6]=a=>e(t).date_planning_fin=a)},null,8,["validator","modelValue"])])])])]),n("div",ze,[Be,n("div",ke,[i(c,{name:"cultural_right_id",label:"DERECHO CULTURAL *",options:e(H),validator:e(l),modelValue:e(t).cultural_right_id,"onUpdate:modelValue":o[7]||(o[7]=a=>e(t).cultural_right_id=a)},null,8,["options","validator","modelValue"]),i(c,{name:"lineament_id",label:"LINEAMIENTO *",options:e(k),validator:e(l),modelValue:e(t).lineament_id,"onUpdate:modelValue":o[8]||(o[8]=a=>e(t).lineament_id=a)},null,8,["options","validator","modelValue"]),i(c,{name:"orientation_id",label:"ORIENTACI\xD3N *",options:e(G),validator:e(l),modelValue:e(t).orientation_id,"onUpdate:modelValue":o[9]||(o[9]=a=>e(t).orientation_id=a)},null,8,["options","validator","modelValue"]),i(c,{name:"value",label:"VALOR *",options:e(q),validator:e(l),modelValue:e(t).value,"onUpdate:modelValue":o[10]||(o[10]=a=>e(t).value=a)},null,8,["options","validator","modelValue"]),i(E,{name:"objective_process",label:"OBJETIVO DEL PROCESO *",placeholder:"Objetivo",rows:"5",modelValue:e(t).objective_process,"onUpdate:modelValue":o[11]||(o[11]=a=>e(t).objective_process=a),validator:e(l)},null,8,["modelValue","validator"]),i(E,{name:"comments",label:"OBSERVACIONES *",placeholder:"Observaci\xF3n",rows:"5",modelValue:e(t).comments,"onUpdate:modelValue":o[12]||(o[12]=a=>e(t).comments=a),validator:e(l)},null,8,["modelValue","validator"]),n("div",He,[i(c,{name:"strengthening_type",label:"TIPO DE FORTALECIMIENTO *",options:e(W),validator:e(l),modelValue:e(t).strengthening_type,"onUpdate:modelValue":o[13]||(o[13]=a=>e(t).strengthening_type=a)},null,8,["options","validator","modelValue"])]),n("div",Ge,[i(E,{name:"strengthening_comments",label:"COMENTARIOS DEL FORTALECIMIENTO *",placeholder:"Comentario",rows:"5",modelValue:e(t).strengthening_comments,"onUpdate:modelValue":o[14]||(o[14]=a=>e(t).strengthening_comments=a),validator:e(l)},null,8,["modelValue","validator"])]),n("div",qe,[i(E,{name:"topics_to_strengthened",label:"TEM\xC1TICAS A FORTALECER SEG\xDAN ROL *",placeholder:"Tem\xE1tica",rows:"5",modelValue:e(t).topics_to_strengthened,"onUpdate:modelValue":o[15]||(o[15]=a=>e(t).topics_to_strengthened=a),validator:e(l)},null,8,["modelValue","validator"])]),i(j,{name:"development_activity_image",label:"FOTO DEL DESARROLLO *",validator:e(l),onAddfile:o[16]||(o[16]=(a,p)=>{e(t).development_activity_image=p.file}),onRemovefile:o[17]||(o[17]=a=>{e(t).development_activity_image=null}),to_edit:e(g)&&e(h)!=null?e(h).development_activity_image:null,files:e(b)},null,8,["validator","to_edit","files"]),i(j,{name:"evidence_participation_image",label:"EVIDENCIA DE PARTICIPACI\xD3N *",validator:e(l),onAddfile:o[18]||(o[18]=(a,p)=>{e(t).evidence_participation_image=p.file}),onRemovefile:o[19]||(o[19]=a=>{e(t).evidence_participation_image=null}),to_edit:e(g)&&e(h)!=null?e(h).evidence_participation_image:null,files:e(b)},null,8,["validator","to_edit","files"])])]),n("div",Je,[Ke,n("div",Qe,[i(Ce,{name:"aggregates",headers:X,aggregates:e(t).aggregates,options:e(D),validator:e(l),onPush:o[20]||(o[20]=a=>e(t).aggregates.push(a)),onPop:o[21]||(o[21]=a=>{e(t).aggregates.splice(e(t).aggregates.indexOf(a),1)})},null,8,["aggregates","options","validator"])])]),We],40,Ne)],8,Ie)])],64))}});export{Ct as default};
