import{b as ae,s as z,m as ie,d as oe,v as g,r as E,c as se,E as T,N as F,Q as b,f as R,g as w,i as r,w as ne,j as le,t as P,l as e,y as re,k as B,h as n,ad as de,F as me,q as ce}from"./index.c93647e1.js";import{u as ue}from"./index.esm.8471a966.js";import{s as _e}from"./strengthening_supervision_manager.service.27eb464a.js";import{p as x}from"./permissions.c73d0fc1.js";import{r as l,n as pe,m as ge,b as j,d as k}from"./validations.9fff8c5b.js";import{_}from"./Input.d2784565.js";import{_ as G}from"./Textarea.8cc31183.js";import{_ as ve,a as H}from"./Management.8f9978fe.js";import{_ as fe}from"./Radio.33857de6.js";import{_ as C}from"./Select.7b4ad9bd.js";import{s as Ve}from"./scroll.6a87917e.js";import{c as ye}from"./generals.service.ee73141b.js";import{_ as he}from"./FormHeader.f0e8692c.js";import"./index.esm.c98934a4.js";import"./useSlug.fdbf14df.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const Ae=ae(),{options:q}=z(Ae),Ie=ie("strengtheningSupervisionManager",{state:()=>({form:{consecutive:"",revision_date:"",nac_id:"",user_associate_id:"",methodological_instruction_id:"",address:"",frequency:"",methodological_instruction_reached_target:"",description:"",start_time:"",final_time:"",comments:"",development_activity_image:null,evidence_participation_image:null,binnacle_registered_plataform:""},form_rules:{revision_date:{required:l},nac_id:{required:l},user_associate_id:{required:l},methodological_instruction_id:{},address:{required:l},frequency:{required:l,numeric:pe,minLength:ge(0)},methodological_instruction_reached_target:{required:l},description:{required:l,maxLength:j(3500)},start_time:{required:l,checkMinMaxHours:k("start_time","final_time")},final_time:{required:l,checkMinMaxHours:k("start_time","final_time")},comments:{required:l,maxLength:j(3500)},development_activity_image:{required:l},evidence_participation_image:{required:l},binnacle_registered_plataform:{required:l}},validator:{generalData:!0},form_options:{nacs:q.value.nacs,decisions:q.value.decisions},instance:{status:null,reject_message:null}}),getters:{form_rules_computed:v=>({...v.form_rules,development_activity_image:v.form.development_activity_image===!1?{}:{required:l},evidence_participation_image:v.form.evidence_participation_image===!1?{}:{required:l}})},actions:{}}),Ee={class:"intro-y box mt-5"},Se=["disabled"],be=["onSubmit"],Re={class:"grid gap-5 grid-cols-1 md:grid-cols-3"},xe=n("div",{class:"intro-y flex justify-between items-start md:items-end mt-5"},[n("div",{class:"intro-y flex flex-col items-start gap-1"},[n("h2",{class:"text-lg font-medium mr-auto"},"CRITERIOS DE EVALUACI\xD3N")])],-1),Ce={class:"grid gap-5 grid-cols-1 md:grid-cols-3"},Ne=n("div",{class:"intro-y flex justify-between items-start md:items-end mt-5"},[n("div",{class:"intro-y flex flex-col items-start gap-1"},[n("h2",{class:"text-lg font-medium mr-auto"}," VISITA DE SUPERVISI\xD3N DEL GESTOR AL TERRITORIO ")])],-1),De={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},Ue={class:"grid gap-5 grid-cols-1"},Oe={class:"grid gap-5 grid-cols-2"},Me={class:"grid gap-5 grid-cols-1"},$e={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},Le={key:0,class:"flex justify-center"},Te=["disabled"],at=oe({__name:"Form",setup(v){const N=ye(),d=_e(),m=Ie(),{form:i,form_rules:J,form_options:D,instance:f}=z(m),p=ce(),S=g(()=>!!p.params.id),V=E([]),u=E([]),y=E(!1),Q=g(()=>({...J.value,methodological_instruction_id:u.value.length>=1?{required:l}:{}})),s=ue(Q,i,{$autoDirty:!0,$lazy:!0}),h=E({development_activity_image:[],evidence_participation_image:[]}),A=g(()=>!!p.params.id),K=async()=>await d.getOne(p.params.id);se(async()=>{I(),A.value?(m.$reset(),s.value.$reset(),await K().then(()=>{const{created_at:o,status:t,nac:a,user_manager:c,user_associate_id:L,methodological_instruction_id:Fe,reject_message:Z,...ee}=d.data.one;M(a.id),$(c.id),m.$patch(te=>{Object.assign(te.form,{...ee})}),f.value.status=t,f.value.reject_message=Z}).catch(()=>{T.not_found_by_id()})):(m.$reset(),s.value.$reset(),await I())});const W=async()=>{await s.value.$validate()?(y.value=!0,A.value?await d.update(d.data.one.id,m.form).finally(()=>{y.value=!1}):await I().finally(()=>{d.create(m.form).then(async t=>{t.data.success&&(h.value.development_activity_image=[],h.value.evidence_participation_image=[],u.value=[],V.value=[],m.$reset(),s.value.$reset(),Ve(),await I())}).finally(()=>{y.value=!1})})):b.validation()},U=(o,t,a)=>{if(o)return;const{file:c,filename:L}=t;i.value[a]={name:"photo1",file:c,filename:L}},O=o=>{i.value[o]=null},I=async()=>await N.getConsecutive("strengthening_super_mangs","SGT").then(()=>{i.value.consecutive=N.data.value}),X=g(()=>i.value.nac_id),Y=g(()=>i.value.user_associate_id);F(X,async(o,t)=>{o!=""&&o!=null&&o!=t&&await M(o)}),F(Y,async(o,t)=>{o!=""&&o!=null&&o!=t&&await $(o)});const M=async o=>{if(V.value=[],u.value=[],i.value.user_associate_id="",i.value.methodological_instruction_id="",(await d.getProfileRoleUserNac(o)).status==200){let a=d.data.allUserManager;A.value&&(i.value.user_associate_id=d.data.one.user_associate_id),a.length>0?V.value=a:b.personalized("El nac seleccionado no pose\xE9 roles.","info")}},$=async o=>{if((await d.getMethodologicalInstructionUserManager(o)).status==200){let a=d.data.allUserManager;A.value&&(i.value.methodological_instruction_id=d.data.one.methodological_instruction_id),a.length>0?u.value=a:(b.personalized("El usuario seleccionado no pose\xE9 Instrucciones metedologicas.","info"),u.value=[])}};return(o,t)=>(R(),w(me,null,[r(he,{state:{consecutive:e(i).consecutive,status:e(f).status,reject_message:e(f).reject_message}},{default:ne(()=>[le(P(e(S)?`Edici\xF3n de Visita de supervisi\xF3n de gestor #${e(p).params.id}`:"Visita de supervisi\xF3n de gestor"),1)]),_:1},8,["state"]),e(S)&&e(x).strengtheningSupervisionManager.management()?(R(),re(ve,{key:0,onSend:t[0]||(t[0]=a=>e(T).methods.send_management("strengthening_super_mangs",e(p).params.id,a)),class:"mt-5"})):B("",!0),n("div",Ee,[n("fieldset",{disabled:e(x).strengtheningSupervisionManager.no_edit()},[n("form",{onSubmit:de(W,["prevent"]),class:"grid gap-3 grid-cols-1 p-5 border-t border-slate-200/60"},[n("section",Re,[r(_,{type:"date",label:"FECHA REVISI\xD3N *",name:"revision_date",placeholder:"Fecha",modelValue:e(i).revision_date,"onUpdate:modelValue":t[1]||(t[1]=a=>e(i).revision_date=a),validator:e(s)},null,8,["modelValue","validator"]),r(C,{label:"NAC *",tooltip:"Ingrese el NAC",placeholder:"Seleccione",name:"nac_id",modelValue:e(i).nac_id,"onUpdate:modelValue":t[2]||(t[2]=a=>e(i).nac_id=a),options:e(D).nacs,validator:e(s)},null,8,["modelValue","options","validator"]),r(C,{label:"USUARIO (GESTOR CULTURAL) *",tooltip:"Seleccione un usuario gestor",placeholder:"Seleccione",name:"user_associate_id",modelValue:e(i).user_associate_id,"onUpdate:modelValue":t[3]||(t[3]=a=>e(i).user_associate_id=a),options:e(V),validator:e(s)},null,8,["modelValue","options","validator"])]),xe,n("section",Ce,[r(C,{label:"TRANSFERENCIA *",tooltip:"Seleccione un transferencia",placeholder:"Seleccione",name:"methodological_instruction_id",modelValue:e(i).methodological_instruction_id,"onUpdate:modelValue":t[4]||(t[4]=a=>e(i).methodological_instruction_id=a),options:e(u),validator:e(s)},null,8,["modelValue","options","validator"]),r(_,{type:"text",label:"DIRECCI\xD3N *",name:"revision_date",placeholder:"DIRECCI\xD3N",modelValue:e(i).address,"onUpdate:modelValue":t[5]||(t[5]=a=>e(i).address=a),validator:e(s)},null,8,["modelValue","validator"]),r(fe,{label:"\xBFCUMPLIO? *",tooltip:"",name:"methodological_instruction_reached_target",modelValue:e(i).methodological_instruction_reached_target,"onUpdate:modelValue":t[6]||(t[6]=a=>e(i).methodological_instruction_reached_target=a),options:e(D).decisions||null,validator:e(s)},null,8,["modelValue","options","validator"])]),Ne,n("section",De,[r(_,{type:"number",label:"FRECUENCIA *",name:"frequency",placeholder:"FRECUENCIA",modelValue:e(i).frequency,"onUpdate:modelValue":t[7]||(t[7]=a=>e(i).frequency=a),validator:e(s),min:"0"},null,8,["modelValue","validator"]),r(_,{type:"number",label:"BITACORAS REGISTRADAS EN PLATAFORMA *",name:"binnacle_registered_plataform",placeholder:"BITACORAS REGISTRADAS EN PLATAFORMA",modelValue:e(i).binnacle_registered_plataform,"onUpdate:modelValue":t[8]||(t[8]=a=>e(i).binnacle_registered_plataform=a),validator:e(s),min:"0"},null,8,["modelValue","validator"])]),n("section",Ue,[r(G,{label:"DESCRIPCI\xD3N DE LA JORNADA *",placeholder:"DESCRIPCI\xD3N DE LA JORNADA",name:"description",modelValue:e(i).description,"onUpdate:modelValue":t[9]||(t[9]=a=>e(i).description=a),validator:e(s),rows:"3"},null,8,["modelValue","validator"])]),n("section",Oe,[r(_,{type:"time",label:"HORA INICIO",tooltip:"Ingrese la hora de inicio",placeholder:"Hora inicio",name:"start_time",modelValue:e(i).start_time,"onUpdate:modelValue":t[10]||(t[10]=a=>e(i).start_time=a),validator:e(s)},null,8,["modelValue","validator"]),r(_,{type:"time",label:"HORA FINAL",tooltip:"Ingrese la hora final",placeholder:"Hora final",name:"final_time",modelValue:e(i).final_time,"onUpdate:modelValue":t[11]||(t[11]=a=>e(i).final_time=a),validator:e(s)},null,8,["modelValue","validator"])]),n("section",Me,[r(G,{label:"OBSERVACIONES: *",placeholder:"OBSERVACIONES",name:"comments",modelValue:e(i).comments,"onUpdate:modelValue":t[12]||(t[12]=a=>e(i).comments=a),validator:e(s),rows:"3"},null,8,["modelValue","validator"])]),n("section",$e,[r(H,{label:"FOTO DEL DESARROLLO *",tooltip:"Arrastra una imagen JPG/PNG",name:"development_activity_image",ref:"development_activity_image",files:e(h).development_activity_image,validator:e(s),onAddfile:t[13]||(t[13]=(a,c)=>U(a,c,"development_activity_image")),onRemovefile:t[14]||(t[14]=a=>O("development_activity_image")),to_edit:e(d).data.one.development_activity_image,modelValue:e(i).development_activity_image,"onUpdate:modelValue":t[15]||(t[15]=a=>e(i).development_activity_image=a)},null,8,["files","validator","to_edit","modelValue"]),r(H,{label:"EVIDENCIA DE PARTICIPACI\xD3N *",tooltip:"Arrastra una imagen JPG/PNG",name:"evidence_participation_image",ref:"evidence_participation_image",files:e(h).evidence_participation_image,validator:e(s),onAddfile:t[16]||(t[16]=(a,c)=>U(a,c,"evidence_participation_image")),onRemovefile:t[17]||(t[17]=a=>O("evidence_participation_image")),to_edit:e(d).data.one.evidence_participation_image,modelValue:e(i).evidence_participation_image,"onUpdate:modelValue":t[18]||(t[18]=a=>e(i).evidence_participation_image=a)},null,8,["files","validator","to_edit","modelValue"])]),e(x).strengtheningSupervisionManager.no_edit()?B("",!0):(R(),w("div",Le,[n("button",{type:"submit",class:"btn btn-primary w-24 mr-1 mb-2",disabled:e(y)},P(e(S)?"Actualizar":"Ingresar"),9,Te)]))],40,be)],8,Se)])],64))}});export{at as default};
