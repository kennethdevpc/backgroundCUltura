import{b as z,s as D,m as H,Q as x,d as J,v as E,r as C,c as Q,E as O,N as K,f as w,g as W,i as c,w as X,j as Y,t as R,l as e,y as Z,k as ee,h as o,ad as te,B as ae,F as ie,q as se}from"./index.c93647e1.js";import{u as oe}from"./index.esm.8471a966.js";import{m as ne}from"./methodologicalStrengthenings.services.4e8313a0.js";import{p as F}from"./permissions.c73d0fc1.js";import{r as g}from"./validations.9fff8c5b.js";import{h as le}from"./index.esm.c98934a4.js";import{_ as re}from"./Input.d2784565.js";import{_ as de}from"./Textarea.8cc31183.js";import{_ as me,a as U}from"./Management.8f9978fe.js";import{_ as v}from"./Select.7b4ad9bd.js";import{_ as ce}from"./Aggregates.ce7a7b06.js";import{c as ge}from"./generals.service.ee73141b.js";import{s as ue}from"./scroll.6a87917e.js";import{_ as _e}from"./FormHeader.f0e8692c.js";import"./useSlug.fdbf14df.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const pe=z(),{options:f}=D(pe),ve=H("methodologicalStrengthenings",{state:()=>({form:{consecutive:"",development_activity_image:null,evidence_participation_image:null,date:"",nac_id:"",cultural_right_id:"",lineament_id:"",orientation_id:"",value:"",comments:"",aggregates:{assistants:[]}},form_rules:{development_activity_image:{required:g},evidence_participation_image:{required:g},date:{required:g},nac_id:{required:g},cultural_right_id:{required:g},lineament_id:{required:g},orientation_id:{required:g},comments:{required:g},value:{required:g},aggregates:{assistants:[]}},validator:{generalData:!0},form_options:{nacs:f.value.nacs,cultural_rights:f.value.cultural_rights,lineaments:f.value.lineaments,orientations:f.value.orientations,values:f.value.values},instance:{status:null,reject_message:null}}),getters:{get_assistants_id:d=>d.form.aggregates.assistants.map(n=>n.id),get_computed_rules:d=>({...d.form_rules,aggregates:{assistants:{requiredIf:le(()=>d.form.aggregates.assistants.length>0)}}}),transpiled_data(){const{aggregates:d,...n}=this.form;return{...n,assistants:this.get_assistants_id}}},actions:{push_aggregate(d){this.$patch(n=>{n.form.aggregates.assistants.findIndex(m=>m.id===d.id)==-1?n.form.aggregates.assistants.push(d):x.info("Este asistente ya se agrego")})},pop_aggregate(d){this.$patch(n=>{const r=n.form.aggregates.assistants.findIndex(m=>m.id===d);n.form.aggregates.assistants.splice(r,1)})}}}),fe={class:"intro-y box mt-5"},he=["disabled"],Ve=["onSubmit"],ye={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},be={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},Se={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},Ee={id:"asistentes",class:"flex flex-col justify-evenly mb-8"},xe={class:"intro-y form-label font-bold uppercase"},$e=o("span",null," Asistentes Agregados ",-1),Ie={class:"overflow-x-auto overflow-y-hidden"},Ae={class:"flex justify-center"},Ne=["disabled"],Qe=J({__name:"Form",setup(d){const n=ge(),r=ve(),m=ne(),{form:i,form_options:_,instance:h,get_computed_rules:P}=D(r),s=oe(P,i,{$autoDirty:!0,$lazy:!0}),p=se(),$=E(()=>!!p.params.id),V=C({development_activity_image:[],evidence_participation_image:[]}),j=[{text:"ID",value:"id"},{text:"NOMBRE COMPLETO",value:"monitor_fullname"},{text:"NUMERO DE C\xC9DULA",value:"document_number"}],I=E(()=>!!p.params.id),B=async()=>await m.getOne(p.params.id),y=async()=>await n.getConsecutive("methodological_strengthenings","FM").then(()=>{i.value.consecutive=n.data.value});Q(async()=>{await y(),I.value?(r.$reset(),s.value.$reset(),await B().then(()=>{const{created_at:l,id:t,assistants:a,status:u,reject_message:S,...k}=m.data.one;r.$patch(q=>{Object.assign(q.form,{...k,aggregates:{assistants:a.map(({pivot:Ce,...G})=>({...G}))}})}),h.value.status=u,h.value.reject_message=S}).catch(()=>{O.not_found_by_id()})):(r.$reset(),s.value.$reset(),await y())});const L=async()=>{await s.value.$validate()?I.value?await m.update(m.data.one.id,r.transpiled_data):await y().finally(()=>{m.create(r.transpiled_data).then(async t=>{t.data.success&&(V.value.development_activity_image=[],V.value.evidence_participation_image=[],r.$reset(),s.value.$reset(),ue(),await y())})}):x.validation()},A=(l,t,a)=>{if(l)return;const{file:u,filename:S}=t;i.value[a]={name:"photo1",file:u,filename:S}},N=l=>{i.value[l]=null},b=C([]),T=E(()=>i.value.nac_id);K(T,async(l,t)=>{l!=""&&l!=null&&l!=t&&await M(l)});const M=async l=>{await n.getProfileRoleUserNac(l).then(t=>{if(t!=null){let a=t.data.items.original.assistants;a.length>0?b.value=a:(x.personalized("El nac seleccionado no pose\xE9 asistentes.","info"),b.value=[],i.value.aggregates.assistants=[])}})};return(l,t)=>(w(),W(ie,null,[c(_e,{state:{consecutive:e(i).consecutive,status:e(h).status,reject_message:e(h).reject_message}},{default:X(()=>[Y(R(e($)?`Edici\xF3n de Fortalecimiento metodol\xF3gico #${e(p).params.id}`:"Fortalecimiento metodol\xF3gico"),1)]),_:1},8,["state"]),e($)&&e(F).methodologicalStrengthenings.management()?(w(),Z(me,{key:0,onSend:t[0]||(t[0]=a=>e(O).methods.send_management("methodological_strengthenings",e(p).params.id,a)),class:"mt-5"})):ee("",!0),o("div",fe,[o("fieldset",{disabled:e(F).methodologicalStrengthenings.no_edit()},[o("form",{onSubmit:te(L,["prevent"]),class:"grid gap-3 grid-cols-1 p-5 border-t border-slate-200/60"},[o("section",ye,[c(re,{type:"date",label:"FECHA *",name:"date",placeholder:"Fecha",modelValue:e(i).date,"onUpdate:modelValue":t[1]||(t[1]=a=>e(i).date=a),validator:e(s)},null,8,["modelValue","validator"]),c(v,{label:"NAC *",tooltip:"Ingrese el NAC",placeholder:"Seleccione",name:"nac_id",modelValue:e(i).nac_id,"onUpdate:modelValue":t[2]||(t[2]=a=>e(i).nac_id=a),options:e(_).nacs,validator:e(s)},null,8,["modelValue","options","validator"])]),o("section",be,[c(v,{label:"DERECHO CULTURAL*",tooltip:"Ingrese el derecho cultural",placeholder:"Seleccione",name:"cultural_right_id",modelValue:e(i).cultural_right_id,"onUpdate:modelValue":t[3]||(t[3]=a=>e(i).cultural_right_id=a),options:e(_).cultural_rights,validator:e(s)},null,8,["modelValue","options","validator"]),c(v,{label:"LINEAMIENTOS *",tooltip:"Ingrese el lineamientos",placeholder:"Seleccione",name:"lineament_id",modelValue:e(i).lineament_id,"onUpdate:modelValue":t[4]||(t[4]=a=>e(i).lineament_id=a),options:e(_).lineaments,validator:e(s)},null,8,["modelValue","options","validator"]),c(v,{label:"ORIENTACIONES *",tooltip:"Ingrese el orientaci\xF3n",placeholder:"Seleccione",name:"orientation_id",modelValue:e(i).orientation_id,"onUpdate:modelValue":t[5]||(t[5]=a=>e(i).orientation_id=a),options:e(_).orientations,validator:e(s)},null,8,["modelValue","options","validator"]),c(v,{label:"VALOR *",tooltip:"Ingrese el valor",placeholder:"Seleccione",name:"value",modelValue:e(i).value,"onUpdate:modelValue":t[6]||(t[6]=a=>e(i).value=a),options:e(_).values,validator:e(s)},null,8,["modelValue","options","validator"]),c(de,{class:"col-span-full",label:"OBSERVACI\xD3N *",placeholder:"OBSERVACI\xD3N",name:"comments",modelValue:e(i).comments,"onUpdate:modelValue":t[7]||(t[7]=a=>e(i).comments=a),validator:e(s),rows:"3"},null,8,["modelValue","validator"])]),o("section",Se,[c(U,{label:"FOTO DEL DESARROLLO *",tooltip:"Arrastra una imagen JPG/PNG",name:"development_activity_image",ref:"development_activity_image",files:e(V).development_activity_image,validator:e(s),onAddfile:t[8]||(t[8]=(a,u)=>A(a,u,"development_activity_image")),onRemovefile:t[9]||(t[9]=a=>N("development_activity_image")),to_edit:e(m).data.one.development_activity_image,modelValue:e(i).development_activity_image,"onUpdate:modelValue":t[10]||(t[10]=a=>e(i).development_activity_image=a)},null,8,["files","validator","to_edit","modelValue"]),c(U,{label:"EVIDENCIA DE PARTICIPACI\xD3N *",tooltip:"Arrastra una imagen JPG/PNG",name:"evidence_participation_image",ref:"evidence_participation_image",files:e(V).evidence_participation_image,validator:e(s),onAddfile:t[11]||(t[11]=(a,u)=>A(a,u,"evidence_participation_image")),onRemovefile:t[12]||(t[12]=a=>N("evidence_participation_image")),to_edit:e(m).data.one.evidence_participation_image,modelValue:e(i).evidence_participation_image,"onUpdate:modelValue":t[13]||(t[13]=a=>e(i).evidence_participation_image=a)},null,8,["files","validator","to_edit","modelValue"])]),o("section",Ee,[o("div",null,[o("h3",xe,[$e,o("span",null," # "+R(e(i).aggregates.assistants.length),1)])]),o("div",Ie,[c(ce,{onPop:t[14]||(t[14]=a=>e(r).pop_aggregate(a)),onPush:t[15]||(t[15]=a=>e(r).push_aggregate(a)),headers:j,aggregates:e(i).aggregates.assistants,options:e(b),validator:e(s),name:"aggregates"},null,8,["aggregates","options","validator"])])]),o("div",Ae,[o("button",{type:"submit",class:"btn btn-primary w-24 mr-1 mb-2",disabled:e(ae)}," Ingresar ",8,Ne)])],40,Ve)],8,he)])],64))}});export{Qe as default};
