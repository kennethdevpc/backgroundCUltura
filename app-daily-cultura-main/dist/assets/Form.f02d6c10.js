import{m as ie,s as $,b as le,r as j,v as ne,H as M,D as re,E as L,f as I,g as S,i as r,w as de,j as me,t as E,l as e,y as ce,k as D,h as o,ad as ue,B as _e,F as pe,q as ge,Q as ve}from"./index.c93647e1.js";import{p as fe}from"./parentschool.service.709bbfdd.js";import{c as he}from"./generals.service.ee73141b.js";import{u as be}from"./index.esm.8471a966.js";import{r as d,d as F,o as k,i as ye,j as T,k as Ve}from"./validations.9fff8c5b.js";import{_ as f}from"./Input.d2784565.js";import{_ as xe}from"./Select.7b4ad9bd.js";import{_ as O}from"./Textarea.8cc31183.js";import{_ as Ie,a as P}from"./Management.8f9978fe.js";import{_ as B}from"./Aggregates.ce7a7b06.js";import{h as H}from"./index.esm.c98934a4.js";import{p as q}from"./permissions.c73d0fc1.js";import{s as Ee}from"./scroll.6a87917e.js";import{_ as Oe}from"./FormHeader.f0e8692c.js";import"./useSlug.fdbf14df.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const Ae=ie("parentschool",{state:()=>({form:{consecutive:"",date:"",start_time:"",final_time:"",place_attention:"",contact:"",monitor_id:"",objective:"",development:"",conclusions:"",development_activity_image:null,evidence_participation_image:null,aggregates:{assistants:[],monitors:[]}},form_rules:{consecutive:{required:d},date:{required:d},start_time:{required:d,checkMinMaxHours:F("start_time","final_time")},final_time:{required:d,checkMinMaxHours:F("start_time","final_time")},place_attention:{required:d},contact:{required:d},monitor_id:{required:d},objective:{required:d},development:{required:d},conclusions:{required:d},development_activity_image:{required:d},evidence_participation_image:{required:d},aggregates:{assistants:{},monitors:{}}}}),getters:{get_monitors_id:n=>n.form.aggregates.monitors.map(i=>i.id),get_computed_rules:n=>({...n.form_rules,aggregates:{assistants:{requiredIf:H(()=>n.form.aggregates.monitors.length>0)},monitors:{requiredIf:H(()=>n.form.aggregates.assistants.length>0)}}}),transpiled_data(){const{aggregates:n,...i}=this.form;return{...i,added_wizards:n.assistants,assistance_monitors:this.get_monitors_id}}},actions:{push_aggregate(n,i){this.$patch(t=>{i==="a"&&t.form.aggregates.assistants.push(n),i==="m"&&t.form.aggregates.monitors.push(n)})},pop_aggregate(n,i){this.$patch(t=>{if(i==="a"){const _=t.form.aggregates.assistants.findIndex(p=>p.id===n);t.form.aggregates.assistants.splice(_,1)}if(i==="m"){const _=t.form.aggregates.monitors.findIndex(p=>p.id===n);t.form.aggregates.monitors.splice(_,1)}})}}}),Ce={class:"intro-y box mt-5"},Ne=["disabled"],Re=["onSubmit"],we={id:"general_data",class:"grid grid-cols-1 xl:grid xl:grid-cols-2 gap-6 justify-evenly mb-8"},Ue={class:"w-full"},$e={class:"w-full"},je={class:"w-full"},Me={class:"w-full"},Le={class:"w-full"},Se={class:"w-full"},De={class:"lg:col-span-1 xl:col-span-2"},Fe={class:"lg:col-span-1 xl:col-span-2"},ke={class:"lg:col-span-1 xl:col-span-2"},Te={id:"images",class:"mb-8"},Pe={class:"flex flex-col lg:grid lg:grid-cols-2 gap-6 justify-evenly"},Be={class:"flex flex-col justify-evenly mb-8"},He={class:"intro-y form-label font-bold uppercase"},qe=o("span",null," Asistentes Agregados ",-1),ze={key:0,class:"flex flex-col justify-evenly mb-8"},Ge={class:"intro-y form-label font-bold uppercase"},Je=o("span",null," Monitores Agregados ",-1),Qe=o("div",null,null,-1),Ke={class:"flex justify-center"},We=["disabled"],ht={__name:"Form",setup(n){const i=Ae(),{form:t,get_computed_rules:_}=$(i),p=le(),{options:g}=$(p),c=fe(),y=he(),l=be(_,t,{$autoDirty:!0,$lazy:!0}),A=j([]),C=j([]),z=(m,a)=>{if(m)return;const{file:s,filename:b}=a;t.value.development_activity_image={name:"photo1",file:s,filename:b}},G=()=>{t.value.development_activity_image=null},J=(m,a)=>{if(m)return;const{file:s,filename:b}=a;t.value.evidence_participation_image={name:"photo2",file:s,filename:b}},Q=()=>{t.value.evidence_participation_image=null},N=ge(),K=async()=>await c.getOne(N.params.id),h=ne(()=>!!N.params.id),u=M({consecutive:"",status:"",reject_message:""}),V=async()=>await y.getConsecutive("parent_schools","EP").then(()=>{t.value.consecutive=y.data.value,u.consecutive=y.data.value});re(async()=>{if(h.value){i.$reset(),l.value.$reset(),await K().catch(()=>{L.not_found_by_id()});const{added_wizards:m,assistance_monitors:a,created_at:s,id:b,monitor:Xe,reject_message:ee,status:te,updated_at:Ye,user_psychoso_coordinator_id:Ze,consecutive:R,start_time:ae,final_time:se,...oe}=c.data.one;let w=M([]);a.forEach(v=>{const U=g.value.monitors_table.find(x=>x.id==v.monitor_id);w.push(U)}),i.$patch(v=>{Object.assign(v.form,{...oe,consecutive:R,start_time:ae,final_time:se}),v.form.aggregates.assistants=m.map(({nac:U,...x})=>({...x})),v.form.aggregates.monitors=w}),u.consecutive=R,u.status=te,u.reject_message=ee}else i.$reset(),l.value.$reset(),await V()});const W=[{text:"NOMBRE",value:"assistant_name"},{text:"NUMERO DE C\xC9DULA",value:"assistant_document_number"},{text:"CARGO",value:"assistant_position"},{text:"NAC",value:"nac_id"},{text:"TEL\xC9FONO",value:"assistant_phone"},{text:"EMAIL",value:"assistant_email"}],X={fields:[{name:"assistant_name",as:"input",type:"text",placeholder:"NOMBRE",rules:k},{name:"assistant_document_number",as:"input",type:"text",placeholder:"NUMERO DE C\xC9DULA",rules:ye},{name:"assistant_position",as:"input",type:"text",placeholder:"CARGO",rules:k},{name:"nac_id",as:"select",placeholder:"NAC",rules:T().required(),children:g.value.nacs.map(m=>({tag:"option",value:m.value,label:m.label}))},{name:"assistant_phone",as:"input",type:"text",placeholder:"TEL\xC9FONO",rules:Ve},{name:"assistant_email",as:"input",type:"text",placeholder:"EMAIL",rules:T().email()}]},Y=[{text:"ID",value:"id"},{text:"NOMBRE COMPLETO",value:"monitor_fullname"},{text:"NUMERO DE C\xC9DULA",value:"document_number"}],Z=async()=>{await l.value.$validate()?h.value?await c.update(c.data.one.id,i.transpiled_data):await V().finally(()=>{c.create(i.transpiled_data).then(async a=>{a.status==200&&(A.value=[],C.value=[],i.$reset(),l.value.$reset(),Ee(),await V())})}):ve.validation()};return(m,a)=>(I(),S(pe,null,[r(Oe,{state:{consecutive:e(u).consecutive,status:e(u).status,reject_message:e(u).reject_message}},{default:de(()=>[me(E(e(h)?`Edici\xF3n de Escuela de Padres #${e(c).data.one.id}`:"Escuela de Padres"),1)]),_:1},8,["state"]),e(h)&&e(q).parentschools.management()?(I(),ce(Ie,{key:0,class:"mt-5",onSend:a[0]||(a[0]=s=>e(L).methods.send_management("parent_schools",e(c).data.one.id,s))})):D("",!0),o("div",Ce,[o("fieldset",{disabled:e(q).parentschools.no_edit()},[o("form",{onSubmit:ue(Z,["prevent"]),class:"p-5 border-t border-slate-200/60 dark:border-darkmode-400"},[o("section",we,[o("div",Ue,[r(f,{type:"date",label:"FECHA *",tooltip:"Ingrese la fecha",placeholder:"Fecha",name:"date",modelValue:e(t).date,"onUpdate:modelValue":a[1]||(a[1]=s=>e(t).date=s),validator:e(l)},null,8,["modelValue","validator"])]),o("div",$e,[r(xe,{label:"NOMBRE MONITOR CULTURAL *",tooltip:"Ingrese el nombre del monitor cultural",placeholder:"Seleccione",name:"monitor_id",modelValue:e(t).monitor_id,"onUpdate:modelValue":a[2]||(a[2]=s=>e(t).monitor_id=s),options:e(g).monitors_parentschools,validator:e(l)},null,8,["modelValue","options","validator"])]),o("div",je,[r(f,{type:"time",label:"HORA INICIO *",tooltip:"Ingrese la hora de inicio",placeholder:"Hora inicio",name:"start_time",modelValue:e(t).start_time,"onUpdate:modelValue":a[3]||(a[3]=s=>e(t).start_time=s),validator:e(l)},null,8,["modelValue","validator"])]),o("div",Me,[r(f,{type:"time",label:"HORA FINAL *",tooltip:"Ingrese la hora final",placeholder:"Hora final",name:"final_time",min:e(t).start_time,modelValue:e(t).final_time,"onUpdate:modelValue":a[4]||(a[4]=s=>e(t).final_time=s),validator:e(l)},null,8,["min","modelValue","validator"])]),o("div",Le,[r(f,{type:"text",label:"LUGAR ATENCI\xD3N *",tooltip:"Ingrese el nombre del lugar de atenci\xF3n",placeholder:"Lugar Atenci\xF3n",name:"place_attention",modelValue:e(t).place_attention,"onUpdate:modelValue":a[5]||(a[5]=s=>e(t).place_attention=s),validator:e(l)},null,8,["modelValue","validator"])]),o("div",Se,[r(f,{type:"text",label:"CONTACTO *",tooltip:"Ingrese el nombre del contacto",placeholder:"Contacto",name:"contact",modelValue:e(t).contact,"onUpdate:modelValue":a[6]||(a[6]=s=>e(t).contact=s),validator:e(l)},null,8,["modelValue","validator"])]),o("div",De,[r(O,{label:"OBJETIVO *",tooltip:"Ingrese el objetivo",placeholder:"Objetivo",name:"objective",modelValue:e(t).objective,"onUpdate:modelValue":a[7]||(a[7]=s=>e(t).objective=s),validator:e(l),rows:"5"},null,8,["modelValue","validator"])]),o("div",Fe,[r(O,{label:"DESARROLLO *",tooltip:"Ingrese el desarrollo",placeholder:"Desarrollo",name:"development",modelValue:e(t).development,"onUpdate:modelValue":a[8]||(a[8]=s=>e(t).development=s),validator:e(l),rows:"5"},null,8,["modelValue","validator"])]),o("div",ke,[r(O,{label:"CONCLUSIONES *",tooltip:"Ingrese las Conclusiones",placeholder:"Conclusiones",name:"conclusions",modelValue:e(t).conclusions,"onUpdate:modelValue":a[9]||(a[9]=s=>e(t).conclusions=s),validator:e(l),rows:"5"},null,8,["modelValue","validator"])])]),o("section",Te,[o("div",Pe,[r(P,{label:" EVIDENCIAS DEL DESARROLLO *",tooltip:"Arrastra o selecciona una Imagen",name:"development_activity_image",ref:"development_activity_image_ref",modelValue:e(t).development_activity_image,"onUpdate:modelValue":a[10]||(a[10]=s=>e(t).development_activity_image=s),accept_pdf:!0,to_edit:e(c).data.one.development_activity_image,onAddfile:z,onRemovefile:G,files:e(A),validator:e(l)},null,8,["modelValue","to_edit","files","validator"]),r(P,{label:"EVIDENCIA DE PARTICIPACI\xD3N *",tooltip:"Arrastra o selecciona una Imagen",name:"evidence_participation_image",ref:"evidence_participation_image_ref",modelValue:e(t).evidence_participation_image,"onUpdate:modelValue":a[11]||(a[11]=s=>e(t).evidence_participation_image=s),accept_pdf:!0,to_edit:e(c).data.one.evidence_participation_image,onAddfile:J,onRemovefile:Q,files:e(C),validator:e(l)},null,8,["modelValue","to_edit","files","validator"])])]),o("section",Be,[o("div",null,[o("h3",He,[qe,o("span",null," # "+E(e(t).aggregates.assistants.length),1)])]),r(B,{onPop:a[12]||(a[12]=s=>e(i).pop_aggregate(s,"a")),onPush:a[13]||(a[13]=s=>e(i).push_aggregate(s,"a")),headers:W,aggregates:e(t).aggregates.assistants,add_schema:X,name:"aggregates",validator:e(l)},null,8,["aggregates","validator"])]),e(g).monitors_table?(I(),S("section",ze,[o("div",null,[o("h3",Ge,[Je,o("span",null," # "+E(e(t).aggregates.monitors.length),1)])]),r(B,{onPop:a[14]||(a[14]=s=>e(i).pop_aggregate(s,"m")),onPush:a[15]||(a[15]=s=>e(i).push_aggregate(s,"m")),headers:Y,aggregates:e(t).aggregates.monitors,options:e(g).monitors_table||null,name:"aggregates",validator:e(l)},null,8,["aggregates","options","validator"]),Qe])):D("",!0),o("div",Ke,[o("button",{disabled:e(_e),type:"submit",class:"btn btn-primary w-24 ml-2"}," Ingresar ",8,We)])],40,Re)],8,Ne)])],64))}};export{ht as default};
