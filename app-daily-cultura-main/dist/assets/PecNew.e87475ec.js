import{H as w,r as G,K as C,Q as O,E as U,m as oe,a0 as le,s as ie,v as A,N as F,c as se,X as re,f as V,g as $,i as n,w as ne,j as de,t as B,l as e,y as ce,k as R,h as i,ad as pe,n as L,B as ue,F as me,q as _e,a2 as ge,a3 as fe}from"./index.c93647e1.js";import{c as N}from"./generals.service.ee73141b.js";import{p as he}from"./pecs.service.c1afe54a.js";import{p as D}from"./permissions.c73d0fc1.js";import{s as ve}from"./scroll.6a87917e.js";import{u as be}from"./index.esm.8471a966.js";import{_ as f}from"./Input.d2784565.js";import{_ as I}from"./Select.7b4ad9bd.js";import{_ as ye}from"./Textarea.8cc31183.js";import{_ as Ve,a as P}from"./Management.8f9978fe.js";import{_ as Ie}from"./Aggregates.ce7a7b06.js";import{r as d,c as we,d as T,m as xe}from"./validations.9fff8c5b.js";import{_ as Ae}from"./FormHeader.f0e8692c.js";import"./index.37cca9d1.js";import"./useSlug.fdbf14df.js";import"./index.esm.c98934a4.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const j="api/v1";function $e(){const r=w({all:[],one:{}}),s=w({all:[],one:{}}),a=G("");return{data:r,dataOne:s,errors:a,get:async p=>{var g;try{let _=await C.get(`/${j}/${p}`);_.status===200&&(r.all=_.data)}catch(_){O.custom_validation((g=_.response.data.error)!=null?g:_.response.data.message)}},getOne:async(p,g)=>{var _;try{let l=await C.get(`/${j}/${p}/${g}`);return l.status===200&&(s.all=l.data),l}catch(l){l.response.status===404?U.not_found_by_id():O.custom_validation((_=l.response.data.error)!=null?_:l.response.data.message)}}}}const Re=oe("pec",{state:()=>({form:{consecutive:"",nac_id:"",neighborhood_id:"",other_neighborhoods:"",place:"",place_address:"",activity_date:"",start_time:"",final_hour:"",place_type:"",other_place_type:"",place_description:"",place_image1:null,place_image2:null,aggregates:{beneficiaries:[]},group_id:""},form_rules:{consecutive:{},nac_id:{required:d},neighborhood_id:{required:d},place:{required:d,alphaOrAlphanumeric:we},place_address:{required:d},activity_date:{required:d},start_time:{required:d,checkMinMaxHours:T("start_time","final_hour")},final_hour:{required:d,checkMinMaxHours:T("start_time","final_hour")},place_type:{required:d},place_description:{required:d},place_image1:{required:d},place_image2:{required:d},aggregates:{beneficiaries:{required:d,minLength:xe(1)}},group_id:{}}}),getters:{get_beneficiaries_id:r=>r.form.aggregates.beneficiaries.map(s=>s.id),form_rules_computed:r=>({...r.form_rules,other_neighborhoods:r.form.neighborhood_id==="357"?{required:d}:{},place_image1:r.form.place_image1===!1?{}:{required:d},place_image2:r.form.place_image2===!1?{}:{required:d},other_place_type:r.form.other_place_type==="O"?{required:d}:{}}),transpiled_data(){const{aggregates:r,...s}=this.form;return{...s,beneficiary_list:this.get_beneficiaries_id}}},actions:{push_aggregate(r){this.$patch(s=>{s.form.aggregates.beneficiaries.push(r)})},pop_aggregate(r){this.$patch(s=>{const a=s.form.aggregates.beneficiaries.findIndex(b=>b.id===r);s.form.aggregates.beneficiaries.splice(a,1)})}}});const Oe=r=>(ge("data-v-0fe0e007"),r=r(),fe(),r),Ue={class:"intro-y box mt-5"},Ee=["disabled"],Se=["onSubmit"],Ce={id:"GeneralData",class:"flex flex-col lg:grid lg:grid-cols-2 xl:grid xl:grid-cols-3 gap-6 justify-evenly mb-8"},Fe={class:"w-full"},Be={class:"w-full"},Le={key:0,class:"w-full intro-x"},Ne={class:"w-full"},De={class:"w-full"},Pe={class:"w-full"},Te={class:"w-full"},je={class:"w-full"},Ge={class:"w-full"},ke={key:0,class:"w-full intro-x"},He={class:"col-span-2 xl:col-span-3"},Me={id:"Images",class:"mb-8"},qe={class:"flex flex-col lg:grid lg:grid-cols-2 gap-6 justify-evenly"},ze={class:"w-full"},Ke={class:"flex flex-col justify-start mb-8"},Qe={class:"intro-y form-label font-bold uppercase"},Xe=Oe(()=>i("span",null," Asistentes Agregados ",-1)),Je={class:"flex justify-center"},We=["disabled"],Ye={__name:"PecNew",setup(r){const s=Re(),{form:a,form_rules_computed:b}=ie(s),m=$e(),p=he(),g=N(),_=N(),l=be(b,a,{$autoDirty:!0,$lazy:!0}),y=w({I:[],II:[]}),k=(u,t)=>{if(u)return;const{file:o,filename:h}=t;a.value.place_image1={name:"photo1",file:o,filename:h}},H=()=>{a.value.place_image1=null},M=(u,t)=>{if(u)return;const{file:o,filename:h}=t;a.value.place_image2={name:"photo2",file:o,filename:h}},q=()=>{a.value.place_image2=null},E=_e(),c=w({status:"",reject_message:"",neighborhoods:[],placeTypes:[],nacs:[],beneficiariesTable:[],groupBeneficiaries:[]}),v=A(()=>!!E.params.id),x=async()=>await g.getConsecutive("pecs","PC").then(()=>{a.value.consecutive=g.data.value}),z=async()=>await p.getOne(E.params.id),K=G([]),S=async u=>{v.value||await _.getGroupBeneficiaries(u).then(t=>{if(t!=null){let o=t.data.items[0].beneficiaries;K.value=o,s.$patch(h=>{h.form.aggregates.beneficiaries=o})}})};A(()=>a.value.nac_id);const Q=A(()=>a.value.group_id);F(Q,async(u,t)=>{u!=""&&u!=null&&u!=t&&await S(u)}),F(()=>a.value.nac_id,async()=>{a.value.nac_id&&await m.getOne("get_neighborhoods",a.value.nac_id).then(()=>{c.neighborhoods=m.dataOne.all})}),se(async()=>{await m.get("get_place_types").then(()=>{c.placeTypes=m.data.all}),await m.get("get_nacs").then(()=>{c.nacs=m.data.all}),await m.get("get_group_beneficiaries").then(()=>{c.groupBeneficiaries=m.data.all}),await m.get("get_beneficiaries_table").then(()=>{c.beneficiariesTable=m.data.all}),v.value?(s.$reset(),l.value.$reset(),await z().then(()=>{const{created_at:u,id:t,nac:o,neighborhood:h,beneficiaries:W,status:Y,reject_message:Z,...ee}=p.data.one;s.$patch(ae=>{Object.assign(ae.form,{...ee,aggregates:{beneficiaries:W.map(({pivot:Ze,...te})=>({...te}))}})}),c.status=Y,c.reject_message=Z}).catch(()=>{U.not_found_by_id()})):(s.$reset(),l.value.$reset(),await x(),await S(0))}),re(()=>{s.$reset(),l.value.$reset()});const X=[{text:"ID",value:"id"},{text:"NOMBRE",value:"full_name"},{text:"C\xC9DULA",value:"nuip"}],J=async()=>{await l.value.$validate()?v.value?await p.update(p.data.one.id,s.transpiled_data):await x().finally(()=>{p.create(s.transpiled_data).then(async t=>{t.data.success&&(y.I=[],y.II=[],s.$reset(),l.value.$reset(),ve(),await x())})}):O.validation()};return(u,t)=>(V(),$(me,null,[n(Ae,{state:{consecutive:e(a).consecutive,status:e(c).status,reject_message:e(c).reject_message}},{default:ne(()=>[de(B(e(v)?`Edici\xF3n de PEC #${e(p).data.one.id}`:"PEC"),1)]),_:1},8,["state"]),e(v)&&e(D).pecs.management()?(V(),ce(Ve,{key:0,class:"mt-5",onSend:t[0]||(t[0]=o=>e(U).methods.send_management("pecs",e(p).data.one.id,o))})):R("",!0),i("div",Ue,[i("fieldset",{disabled:e(D).pecs.no_edit()},[i("form",{onSubmit:pe(J,["prevent"]),class:"p-5 border-t border-slate-200/60"},[i("section",Ce,[i("div",Fe,[n(I,{label:"NAC *",tooltip:"Ingrese el NAC",placeholder:"Seleccione",name:"nac_id",modelValue:e(a).nac_id,"onUpdate:modelValue":t[1]||(t[1]=o=>e(a).nac_id=o),options:e(c).nacs,validator:e(l)},null,8,["modelValue","options","validator"])]),i("div",{class:L([e(a).neighborhood_id==357?"grid-cols-1 md:grid-cols-2":"grid-cols-1","w-full grid gap-6"])},[i("div",Be,[n(I,{label:"BARRIO *",tooltip:"Ingrese el barrio",placeholder:"Seleccione",name:"neighborhood_id",modelValue:e(a).neighborhood_id,"onUpdate:modelValue":t[2]||(t[2]=o=>e(a).neighborhood_id=o),options:e(c).neighborhoods,validator:e(l)},null,8,["modelValue","options","validator"])]),e(a).neighborhood_id==357?(V(),$("div",Le,[n(f,{type:"text",label:"ESCRIBA EL BARRIO *",tooltip:"Ingrese el nombre del barrio",placeholder:"Nombre del barrio",name:"other_neighborhoods",modelValue:e(a).other_neighborhoods,"onUpdate:modelValue":t[3]||(t[3]=o=>e(a).other_neighborhoods=o),validator:e(l)},null,8,["modelValue","validator"])])):R("",!0)],2),i("div",Ne,[n(f,{type:"text",label:"LUGAR *",tooltip:"Ingrese el nombre del lugar",placeholder:"Nombre del lugar",name:"place",modelValue:e(a).place,"onUpdate:modelValue":t[4]||(t[4]=o=>e(a).place=o),validator:e(l)},null,8,["modelValue","validator"])]),i("div",De,[n(f,{type:"text",label:"DIRECCI\xD3N DEL LUGAR *",tooltip:"Ingrese la direcci\xF3n del lugar",placeholder:"Direcci\xF3n del lugar",name:"place_address",modelValue:e(a).place_address,"onUpdate:modelValue":t[5]||(t[5]=o=>e(a).place_address=o),validator:e(l)},null,8,["modelValue","validator"])]),i("div",Pe,[n(f,{type:"date",label:"FECHA *",tooltip:"Ingrese la fecha",placeholder:"Fecha",name:"activity_date",modelValue:e(a).activity_date,"onUpdate:modelValue":t[6]||(t[6]=o=>e(a).activity_date=o),validator:e(l)},null,8,["modelValue","validator"])]),i("div",Te,[n(f,{type:"time",label:"HORA INICIO *",tooltip:"Ingrese la hora de inicio",placeholder:"Hora inicio",name:"start_time",modelValue:e(a).start_time,"onUpdate:modelValue":t[7]||(t[7]=o=>e(a).start_time=o),validator:e(l)},null,8,["modelValue","validator"])]),i("div",je,[n(f,{type:"time",label:"HORA FINAL *",tooltip:"Ingrese la hora final",placeholder:"Hora final",name:"final_hour",min:e(a).start_time,modelValue:e(a).final_hour,"onUpdate:modelValue":t[8]||(t[8]=o=>e(a).final_hour=o),validator:e(l)},null,8,["min","modelValue","validator"])]),i("div",{class:L([e(a).place_type==="O"?"grid-cols-1 md:grid-cols-2":"grid-cols-1","w-full grid gap-6 lg:col-span-1 xl:col-span-2"])},[i("div",Ge,[n(I,{label:"TIPO DE LUGAR *",tooltip:"Ingrese el tipo de lugar",placeholder:"Seleccione",name:"place_type",modelValue:e(a).place_type,"onUpdate:modelValue":t[9]||(t[9]=o=>e(a).place_type=o),options:e(c).placeTypes,validator:e(l)},null,8,["modelValue","options","validator"])]),e(a).place_type==="O"?(V(),$("div",ke,[n(f,{type:"text",label:"ESCRIBA EL TIPO *",tooltip:"Ingrese el tipo de lugar",placeholder:"Tipo de lugar",name:"other_place_type",modelValue:e(a).other_place_type,"onUpdate:modelValue":t[10]||(t[10]=o=>e(a).other_place_type=o),validator:e(l)},null,8,["modelValue","validator"])])):R("",!0)],2),i("div",He,[n(ye,{label:"BREVE RESE\xD1A DEL LUGAR *",tooltip:"Ingrese la descripci\xF3n",placeholder:"Descripci\xF3n",name:"place_description",modelValue:e(a).place_description,"onUpdate:modelValue":t[11]||(t[11]=o=>e(a).place_description=o),validator:e(l),rows:"5"},null,8,["modelValue","validator"])])]),i("section",Me,[i("div",qe,[n(P,{label:"FOTOGRAF\xCDA DEL LUGAR *",tooltip:"Arrastra o selecciona una Imagen",name:"place_image1",ref:"place_image1_ref",to_edit:e(p).data.one.place_image1,modelValue:e(a).place_image1,"onUpdate:modelValue":t[12]||(t[12]=o=>e(a).place_image1=o),onAddfile:k,onRemovefile:H,files:e(y).I,validator:e(l)},null,8,["to_edit","modelValue","files","validator"]),n(P,{label:"FOTOGRAF\xCDA DEL LUGAR *",tooltip:"Arrastra o selecciona una Imagen",name:"place_image2",ref:"place_image2_ref",to_edit:e(p).data.one.place_image2,modelValue:e(a).place_image2,"onUpdate:modelValue":t[13]||(t[13]=o=>e(a).place_image2=o),onAddfile:M,onRemovefile:q,files:e(y).II,validator:e(l)},null,8,["to_edit","modelValue","files","validator"])])]),i("div",ze,[n(I,{label:"GRUPO *",tooltip:"Selecciona un grupo",placeholder:"Seleccione",name:"group_id",modelValue:e(a).group_id,"onUpdate:modelValue":t[14]||(t[14]=o=>e(a).group_id=o),options:e(c).groupBeneficiaries,validator:e(l)},null,8,["modelValue","options","validator"])]),i("section",Ke,[i("div",null,[i("h3",Qe,[Xe,i("span",null," # "+B(e(a).aggregates.beneficiaries.length),1)])]),n(Ie,{onPop:t[15]||(t[15]=o=>e(s).pop_aggregate(o)),onPush:t[16]||(t[16]=o=>e(s).push_aggregate(o)),options:e(c).beneficiariesTable||null,headers:X,aggregates:e(a).aggregates.beneficiaries,validator:e(l),name:"aggregates"},null,8,["options","aggregates","validator"])]),i("div",Je,[i("button",{disabled:e(ue),type:"submit",class:"btn btn-primary w-24 ml-2"}," Ingresar ",8,We)])],40,Se)],8,Ee)])],64))}};var ba=le(Ye,[["__scopeId","data-v-0fe0e007"]]);export{ba as default};
