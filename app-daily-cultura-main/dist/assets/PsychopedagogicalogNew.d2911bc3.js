import{m as ie,s as U,b as ne,r as A,v as re,H as j,D as de,E as $,f as L,g as me,i as n,w as ce,j as ue,t as O,l as e,y as pe,k as _e,h as s,ad as ge,F as ve,q as fe,Q as he}from"./index.c93647e1.js";import{p as be}from"./psychopedagogicalog.service.a2ac598b.js";import{c as ye}from"./generals.service.ee73141b.js";import{u as Ee}from"./user.service.5d6ec521.js";import{u as Ve}from"./index.esm.8471a966.js";import{r as d,d as k,o as P,i as xe,j as F,k as Ie}from"./validations.9fff8c5b.js";import{_ as y}from"./Input.d2784565.js";import{_ as B}from"./Select.7b4ad9bd.js";import{_ as v}from"./Textarea.8cc31183.js";import{_ as Ae,a as T}from"./Management.8f9978fe.js";import{_ as H}from"./Aggregates.ce7a7b06.js";import{s as Oe}from"./scroll.6a87917e.js";import{h as q}from"./index.esm.c98934a4.js";import{p as G}from"./permissions.c73d0fc1.js";import{_ as Re}from"./FormHeader.f0e8692c.js";import"./useSlug.fdbf14df.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const Ne=ie("psychopedagogicalog",{state:()=>({form:{consecutive:"",date:"",nac_id:"",start_time:"",final_time:"",person_served_name:"",monitor_id:"",objective:"",development:"",referrals:"",conclusions_reflections_commitments:"",alert_reporting_tracking:"",development_activity_image:null,evidence_participation_image:null,aggregates:{assistants:[],monitors:[]}},form_rules:{consecutive:{required:d},date:{required:d},nac_id:{required:d},start_time:{required:d,checkMinMaxHours:k("start_time","final_time")},final_time:{required:d,checkMinMaxHours:k("start_time","final_time")},person_served_name:{required:d},monitor_id:{required:d},objective:{required:d},development:{required:d},referrals:{required:d},conclusions_reflections_commitments:{required:d},alert_reporting_tracking:{required:d},development_activity_image:{required:d},evidence_participation_image:{required:d},aggregates:{assistants:{},monitors:{}}}}),getters:{get_monitors_id:r=>r.form.aggregates.monitors.map(l=>l.id),get_computed_rules:r=>({...r.form_rules,aggregates:{assistants:{requiredIf:q(()=>r.form.aggregates.monitors.length>0)},monitors:{requiredIf:q(()=>r.form.aggregates.assistants.length>0)}}}),transpiled_data(){const{aggregates:r,...l}=this.form;return{...l,added_wizards:r.assistants,assistance_monitors:r.monitors.map(a=>a.id)}}},actions:{push_aggregate(r,l){this.$patch(a=>{l==="a"&&a.form.aggregates.assistants.push(r),l==="m"&&a.form.aggregates.monitors.push(r)})},pop_aggregate(r,l){this.$patch(a=>{if(l==="a"){const p=a.form.aggregates.assistants.findIndex(_=>_.id===r);a.form.aggregates.assistants.splice(p,1)}if(l==="m"){const p=a.form.aggregates.monitors.findIndex(_=>_.id===r);a.form.aggregates.monitors.splice(p,1)}})}}}),we={class:"intro-y box mt-5"},Me=["disabled"],Ce=["onSubmit"],De={id:"general_data",class:"flex flex-col lg:grid lg:grid-cols-1 xl:grid xl:grid-cols-2 gap-6 justify-evenly mb-8"},Se={class:"w-full"},Ue={class:"w-full"},je={class:"w-full"},$e={class:"w-full"},Le={class:"w-full"},ke={class:"w-full"},Pe={class:"lg:col-span-1 xl:col-span-2"},Fe={class:"lg:col-span-1 xl:col-span-2"},Be={class:"lg:col-span-1 xl:col-span-2"},Te={class:"lg:col-span-1 xl:col-span-2"},He={class:"lg:col-span-1 xl:col-span-2"},qe={id:"images",class:"mb-8"},Ge={class:"flex flex-col lg:grid lg:grid-cols-2 gap-6 justify-evenly"},ze={id:"asistentes",class:"flex flex-col justify-evenly mb-8"},Je={class:"intro-y form-label font-bold uppercase"},Qe=s("span",null," Asistentes Agregados ",-1),Xe={class:"overflow-x-auto overflow-y-hidden"},Ye={id:"monitors",class:"flex flex-col justify-evenly mb-8"},Ke={class:"intro-y form-label font-bold uppercase"},We=s("span",null," Monitores Agregados ",-1),Ze={class:"overflow-x-auto overflow-y-hidden"},ea=s("div",null,null,-1),aa={class:"flex justify-center"},ta=["disabled"],xa={__name:"PsychopedagogicalogNew",setup(r){const l=Ne(),{form:a,get_computed_rules:p}=U(l),_=ne(),{options:f}=U(_),{monitors:z,nacs:J}=f.value,m=be(),E=ye();new Ee;const i=Ve(p,a,{$autoDirty:!0,$lazy:!0}),h=A(!1),R=A([]),N=A([]),Q=(c,t)=>{if(c)return;const{file:o,filename:g}=t;a.value.development_activity_image={name:"photo1",file:o,filename:g}},X=()=>{a.value.development_activity_image=null},Y=(c,t)=>{if(c)return;const{file:o,filename:g}=t;a.value.evidence_participation_image={name:"photo2",file:o,filename:g}},K=()=>{a.value.evidence_participation_image=null},w=fe(),W=async()=>await m.getOne(w.params.id),b=re(()=>!!w.params.id),u=j({consecutive:"",status:"",reject_message:""}),V=async()=>await E.getConsecutive("psychopedagogical_logbooks","BTP").then(()=>{a.value.consecutive=E.data.value,u.consecutive=E.data.value});de(async()=>{if(b.value){l.$reset(),await W().catch(()=>{$.not_found_by_id()});const{created_at:c,id:t,assistants:o,monitors:g,nac:oa,consecutive:M,date:oe,status:C,reject_message:se,...le}=m.data.one;let D=j([]);g.forEach(x=>{const S=f.value.monitors_table.find(I=>I.id==x.monitor_id);D.push(S)}),l.$patch(x=>{Object.assign(x.form,{...le,date:oe,status:C,consecutive:M,aggregates:{assistants:o.map(({nac:S,...I})=>({...I})),monitors:D}})}),u.consecutive=M,u.status=C,u.reject_message=se}else l.$reset(),i.value.$reset(),await V()});const Z=[{text:"NOMBRE",value:"assistant_name"},{text:"NUMERO DE C\xC9DULA",value:"assistant_document_number"},{text:"CARGO",value:"assistant_position"},{text:"NAC",value:"nac_id"},{text:"TEL\xC9FONO",value:"assistant_phone"},{text:"EMAIL",value:"assistant_email"}],ee={fields:[{name:"assistant_name",as:"input",type:"text",placeholder:"NOMBRE",rules:P},{name:"assistant_document_number",as:"input",type:"text",placeholder:"NUMERO DE C\xC9DULA",rules:xe},{name:"assistant_position",as:"input",type:"text",placeholder:"CARGO",rules:P},{name:"nac_id",as:"select",placeholder:"NAC",rules:F().required(),children:f.value.nacs.map(c=>({tag:"option",value:c.value,label:c.label}))},{name:"assistant_phone",as:"input",type:"tel",placeholder:"TEL\xC9FONO",rules:Ie},{name:"assistant_email",as:"input",type:"text",placeholder:"EMAIL",rules:F().email()}]},ae=[{text:"ID",value:"id"},{text:"NOMBRE COMPLETO",value:"monitor_fullname"},{text:"NUMERO DE C\xC9DULA",value:"document_number"}],te=async()=>{await i.value.$validate()?(h.value=!0,b.value?await m.update(m.data.one.id,l.transpiled_data).finally(()=>{h.value=!1}):await V().finally(()=>{m.create(l.transpiled_data).then(async t=>{t.status&&t.data.success&&(l.$reset(),i.value.$reset(),await V(),Oe(),R.value=[],N.value=[])})}).finally(()=>{h.value=!1})):he.validation()};return(c,t)=>(L(),me(ve,null,[n(Re,{state:{consecutive:e(a).consecutive,status:e(u).status,reject_message:e(u).reject_message}},{default:ce(()=>[ue(O(e(b)?`Edici\xF3n de Bit\xE1cora Psicopedag\xF3gica #${e(m).data.one.id}`:"Bit\xE1cora Psicopedag\xF3gica"),1)]),_:1},8,["state"]),e(b)&&e(G).psychopedagogicallogs.management()?(L(),pe(Ae,{key:0,class:"mt-5",onSend:t[0]||(t[0]=o=>e($).methods.send_management("psychopedagogical_logbooks",e(m).data.one.id,o))})):_e("",!0),s("div",we,[s("fieldset",{disabled:e(G).psychopedagogicallogs.no_edit()},[s("form",{onSubmit:ge(te,["prevent"]),class:"px-5 sm:px-10 py-10 border-t border-slate-200/60 dark:border-darkmode-400"},[s("section",De,[s("div",Se,[n(y,{type:"date",label:"FECHA *",tooltip:"Ingrese la fecha",placeholder:"Fecha",name:"date",modelValue:e(a).date,"onUpdate:modelValue":t[1]||(t[1]=o=>e(a).date=o),validator:e(i)},null,8,["modelValue","validator"])]),s("div",Ue,[n(B,{label:"NAC *",tooltip:"Ingrese el NAC",placeholder:"Seleccione",name:"nac_id",modelValue:e(a).nac_id,"onUpdate:modelValue":t[2]||(t[2]=o=>e(a).nac_id=o),options:e(J),validator:e(i)},null,8,["modelValue","options","validator"])]),s("div",je,[n(y,{type:"time",label:"HORA INICIO *",tooltip:"Ingrese la hora de inicio",placeholder:"Hora inicio",name:"start_time",modelValue:e(a).start_time,"onUpdate:modelValue":t[3]||(t[3]=o=>e(a).start_time=o),validator:e(i)},null,8,["modelValue","validator"])]),s("div",$e,[n(y,{type:"time",label:"HORA FINAL *",tooltip:"Ingrese la hora final",placeholder:"Hora final",name:"final_time",min:e(a).start_time,modelValue:e(a).final_time,"onUpdate:modelValue":t[4]||(t[4]=o=>e(a).final_time=o),validator:e(i)},null,8,["min","modelValue","validator"])]),s("div",Le,[n(y,{type:"text",label:"NOMBRE PERSONA ATENDIDA *",tooltip:"Ingrese el nombre de la persona atendida",placeholder:"Nombre de persona",name:"person_served_name",modelValue:e(a).person_served_name,"onUpdate:modelValue":t[5]||(t[5]=o=>e(a).person_served_name=o),validator:e(i)},null,8,["modelValue","validator"])]),s("div",ke,[n(B,{label:"NOMBRE MONITOR CULTURAL *",tooltip:"Ingrese el nombre del monitor cultural",placeholder:"Seleccione",name:"monitor_id",modelValue:e(a).monitor_id,"onUpdate:modelValue":t[6]||(t[6]=o=>e(a).monitor_id=o),options:e(z),validator:e(i)},null,8,["modelValue","options","validator"])]),s("div",Pe,[n(v,{label:"OBJETIVO *",tooltip:"Ingrese el objetivo",placeholder:"Objetivo",name:"objective",modelValue:e(a).objective,"onUpdate:modelValue":t[7]||(t[7]=o=>e(a).objective=o),validator:e(i),rows:"5"},null,8,["modelValue","validator"])]),s("div",Fe,[n(v,{label:"DESARROLLO *",tooltip:"Ingrese el desarrollo",placeholder:"Desarrollo",name:"development",modelValue:e(a).development,"onUpdate:modelValue":t[8]||(t[8]=o=>e(a).development=o),validator:e(i),rows:"5"},null,8,["modelValue","validator"])]),s("div",Be,[n(v,{label:"REMISIONES *",tooltip:"Ingrese las remisiones",placeholder:"Remisiones",name:"referrals",modelValue:e(a).referrals,"onUpdate:modelValue":t[9]||(t[9]=o=>e(a).referrals=o),validator:e(i),rows:"5"},null,8,["modelValue","validator"])]),s("div",Te,[n(v,{label:"CONCLUSIONES, REFLEXIONES Y COMPROMISOS DE LA JORNADA *",tooltip:"Ingrese las conclusiones, reflexiones y compromisos de la jornada",placeholder:"Remisiones",name:"conclusions_reflections_commitments",modelValue:e(a).conclusions_reflections_commitments,"onUpdate:modelValue":t[10]||(t[10]=o=>e(a).conclusions_reflections_commitments=o),validator:e(i),rows:"5"},null,8,["modelValue","validator"])]),s("div",He,[n(v,{label:"REPORTE DE ALERTA PARA HACER SEGUIMIENTO *",tooltip:"Ingrese el reporte",placeholder:"Reporte",name:"alert_reporting_tracking",modelValue:e(a).alert_reporting_tracking,"onUpdate:modelValue":t[11]||(t[11]=o=>e(a).alert_reporting_tracking=o),validator:e(i),rows:"5"},null,8,["modelValue","validator"])])]),s("section",qe,[s("div",Ge,[n(T,{label:"EVIDENCIA DEL DESARROLLO *",tooltip:"Arrastra o selecciona una Imagen o PDF",name:"development_activity_image",ref:"development_activity_image_ref",modelValue:e(a).development_activity_image,"onUpdate:modelValue":t[12]||(t[12]=o=>e(a).development_activity_image=o),accept_pdf:!0,to_edit:e(m).data.one.development_activity_image,onAddfile:Q,onRemovefile:X,files:e(R),validator:e(i)},null,8,["modelValue","to_edit","files","validator"]),n(T,{label:"EVIDENCIA DE PARTICIPACI\xD3N *",tooltip:"Arrastra o selecciona una Imagen o PDF",name:"evidence_participation_image",ref:"evidence_participation_image_ref",modelValue:e(a).evidence_participation_image,"onUpdate:modelValue":t[13]||(t[13]=o=>e(a).evidence_participation_image=o),accept_pdf:!0,to_edit:e(m).data.one.evidence_participation_image,onAddfile:Y,onRemovefile:K,files:e(N),validator:e(i)},null,8,["modelValue","to_edit","files","validator"])])]),s("section",ze,[s("div",null,[s("h3",Je,[Qe,s("span",null," # "+O(e(a).aggregates.assistants.length),1)])]),s("div",Xe,[n(H,{onPop:t[14]||(t[14]=o=>e(l).pop_aggregate(o,"a")),onPush:t[15]||(t[15]=o=>e(l).push_aggregate(o,"a")),headers:Z,aggregates:e(a).aggregates.assistants,add_schema:ee,name:"aggregates",validator:e(i)},null,8,["aggregates","validator"])])]),s("section",Ye,[s("div",null,[s("h3",Ke,[We,s("span",null," # "+O(e(a).aggregates.monitors.length),1)])]),s("div",Ze,[n(H,{onPop:t[16]||(t[16]=o=>e(l).pop_aggregate(o,"m")),onPush:t[17]||(t[17]=o=>e(l).push_aggregate(o,"m")),headers:ae,aggregates:e(a).aggregates.monitors,options:e(f).monitors_table,name:"aggregates",validator:e(i)},null,8,["aggregates","options","validator"])]),ea]),s("div",aa,[s("button",{disabled:e(h),type:"submit",class:"btn btn-primary w-24 ml-2"}," Ingresar ",8,ta)])],40,Ce)],8,Me)])],64))}};export{xa as default};
