import{d as S,H as v,v as g,r as j,c as E,E as y,f as h,g as I,i as d,w as D,j as M,t as B,l as e,y as N,k,h as i,ad as R,B as A,F as O,q as U,Q as q}from"./index.c93647e1.js";import{s as H}from"./scroll.6a87917e.js";import{p as b}from"./permissions.c73d0fc1.js";import{c as P}from"./generals.service.ee73141b.js";import{m as T}from"./monthly_monitoring_reports.service.36690c67.js";import{u as z}from"./index.esm.8471a966.js";import{_ as L}from"./Input.d2784565.js";import{_ as Q}from"./Textarea.8cc31183.js";import{_ as W,a as X}from"./Management.8f9978fe.js";import{r as c}from"./validations.9fff8c5b.js";import{_ as G}from"./FormHeader.f0e8692c.js";import"./Select.7b4ad9bd.js";import"./useSlug.fdbf14df.js";import"./index.esm.c98934a4.js";import"./StateHeader.5dfd959d.js";import"./get_status.6c591513.js";import"./BaseBackButton.438a649f.js";const J={class:"intro-y box mt-5"},K=["disabled"],Y=["onSubmit"],Z={class:"flex flex-col md:grid md:grid-cols-2 gap-6 justify-evenly"},ee={class:"w-full"},te={class:"w-full"},ae={class:"w-full"},se={class:"flex justify-end"},oe=["disabled"],Ve=S({__name:"monthly_monitoring_reports_form",setup(ie){const a=T(),m=P(),t=v({consecutive:"",date:"",description:"",file:null}),w=()=>{t.consecutive="",t.date="",t.file=null,t.description=""},x=g(()=>({consecutive:{required:c},date:{required:c},description:{required:c},file:{required:c}})),r=z(x,t,{$autoDirty:!0,$lazy:!0}),p=j([]),V=(f,s)=>{if(f)return;const{file:o}=s;t.file=o},F=()=>{t.file=null},_=U(),n=v({status:"",consecutive:"",reject_message:""}),l=g(()=>!!_.params.id),u=async()=>await m.getConsecutive("monthly_monitoring_reports","IMS").then(()=>{t.consecutive=m.data.value,n.consecutive=m.data.value}),$=async()=>await a.getOne(_.params.id);E(async()=>{l.value?(await $().catch(()=>{y.not_found_by_id()}),a.data.one&&(n.status=a.data.one.status,n.consecutive=a.data.one.consecutive,n.reject_message=a.data.one.reject_message,t.consecutive=a.data.one.consecutive,t.date=a.data.one.date,t.description=a.data.one.description,t.file=a.data.one.file)):await u()});const C=async()=>{await r.value.$validate()?l.value?await a.update(a.data.one.id,t):await u().finally(()=>{a.create(t).then(async s=>{s.data.success&&(p.value=[],w(),r.value.$reset(),H(),await u())})}):q.validation()};return(f,s)=>(h(),I(O,null,[d(G,{state:{consecutive:e(n).consecutive,status:e(n).status,reject_message:e(n).reject_message}},{default:D(()=>[M(B(e(l)?`Edici\xF3n de Informe mensual de supervisi\xF3n #${e(a).data.one.id}`:"Informe mensual de supervisi\xF3n"),1)]),_:1},8,["state"]),e(l)&&e(b).monthlyMonitoring.management()?(h(),N(W,{key:0,class:"mt-5",onSend:s[0]||(s[0]=o=>e(y).methods.send_management("monthly_monitoring_reports",e(a).data.one.id,o))})):k("",!0),i("div",J,[i("fieldset",{disabled:e(b).monthlyMonitoring.no_edit()},[i("form",{onSubmit:R(C,["prevent"]),class:"p-5 border-t border-slate-200/60 space-y-8"},[i("section",Z,[i("div",ee,[d(L,{type:"date",label:"FECHA *",tooltip:"Ingrese la fecha",placeholder:"Fecha",name:"date",modelValue:e(t).date,"onUpdate:modelValue":s[1]||(s[1]=o=>e(t).date=o),validator:e(r)},null,8,["modelValue","validator"])]),i("div",te,[d(X,{label:"DOCUMENTO *",tooltip:"Arrastra o selecciona un documento WORD, PDF o EXCEL",name:"file",ref:"file_ref",to_edit:e(a).data.one.file,modelValue:e(t).file,"onUpdate:modelValue":s[2]||(s[2]=o=>e(t).file=o),onAddfile:V,onRemovefile:F,files:e(p),accept_docs:!0,validator:e(r)},null,8,["to_edit","modelValue","files","validator"])]),i("div",ae,[d(Q,{label:"DESCRIPCI\xD3N *",placeholder:"Ingrese descripci\xF3n",name:"description",modelValue:e(t).description,"onUpdate:modelValue":s[3]||(s[3]=o=>e(t).description=o),validator:e(r),rows:"5"},null,8,["modelValue","validator"])])]),i("div",se,[i("button",{disabled:e(A),type:"submit",class:"btn btn-primary w-24 ml-2"}," Ingresar ",8,oe)])],40,Y)],8,K)])],64))}});export{Ve as default};
